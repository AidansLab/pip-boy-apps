function DiceRoller(){function K(){a.x+=a.vx,a.y+=a.vy;const c=30;const g=5;(a.x<d.x1+c+g||a.x>d.x2-c-g)&&(a.vx=-a.vx*s,a.x=Math.max(d.x1+c+g,Math.min(a.x,d.x2-c-g))),(a.y<d.y1+c+g||a.y>d.y2-c-g)&&(a.vy=-a.vy*s,a.y=Math.max(d.y1+c+g,Math.min(a.y,d.y2-c-g))),a.vx*=t,a.vy*=t;const i=Math.sqrt(a.vx*a.vx+a.vy*a.vy);const l=p(h[b]);e&&clearTimeout(e);const o=Math.max(50,600-i*80);e=setTimeout(()=>{j=Math.floor(Math.random()*l)+1,k()},o),n++,k(),(n>=40||i<.5)&&(f&&clearInterval(f),e&&clearTimeout(e),j=Math.floor(Math.random()*l)+1,k(),m=!1)}function L(){f&&clearInterval(f),e&&clearTimeout(e),f=null,e=null}function o(){g.setColor(B),g.fillRect(0,0,v,w)}function C(a){g.setColor(l).drawRect(a.x1,a.y1,a.x2,a.y2)}function k(){g.setColor(B),g.fillRect(i.x,i.y,i.x+i.w,i.y+i.h);const e=60;const c=e/2;const d=M(h[b]);g.setColor(l);const f=[];for(let b=0;b<d;b++){const e=Math.PI/2+b*Math.PI*2/d;f.push([a.x+c*Math.cos(e),a.y+c*Math.sin(e)])}for(let a=0;a<d;a++){const b=f[a];const c=f[(a+1)%d];g.drawLine(b[0],b[1],c[0],c[1])}g.setFont('6x8',3),g.setFontAlign(0,0),g.drawString(j+'',a.x,a.y),i={x:a.x-c-2,y:a.y-c-2,w:e+4,h:e+4}}function D(){const a=h[b];g.setColor(l).setFontMonofonto23().setFontAlign(1,-1,0).drawString(a,c.x2-5,c.y1+5)}function F(){g.setColor(l).setFontMonofonto23().setFontAlign(-1,-1,0).drawString(r,c.x1+5,c.y1+5);const a=g.stringWidth(r);g.setColor(J).setFontMonofonto16().setFontAlign(-1,-1,0).drawString('v'+G,c.x1+10+a,c.y1+5+8)}function M(a){switch(a){case'D4':return 3;case'D6':return 4;case'D8':return 5;case'D10':return 6;case'D12':return 6;case'D20':return 6;default:return 6}}function p(a){return parseInt(a.substring(1))}function N(b){let a=Date.now();if(a-A<I)return;A=a,R()}function O(a){if(m)return;b+=a,b<0&&(b=h.length-1),b>=h.length&&(b=0),j=Math.floor(Math.random()*p(h[b]))+1,o(),D(),F(),C(d),k()}function P(){L(),o(),Q(),bC.clear(1).flip(),E.reboot()}function Q(){Pip.removeAllListeners(x),Pip.removeAllListeners(y),Pip.removeAllListeners(z)}function R(){m=!0;const c=p(h[b]);j=Math.floor(Math.random()*c)+1,a.vx=(Math.random()*6-3)*u,a.vy=(Math.random()*6-3)*u,n=0,f&&clearInterval(f),f=setInterval(K,100)}function S(){Pip.on(x,N),Pip.on(y,O),Pip.on(z,P)}const q={};const r='Dice Roller';const G='1.0.0';const h=['D4','D6','D8','D10','D12','D20'];const s=.95;const t=.98;const u=8;let b=5;let a={x:100,y:100,vx:2,vy:3};let j=1;let e=null;let f=null;let m=!1;let i={x:0,y:0,w:0,h:0};let n=0;const v=g.getWidth();const w=g.getHeight();const c={x1:60,x2:v-60,y1:10,y2:w-10};const H=35;const d={x1:c.x1,x2:c.x2,y1:c.y1+H,y2:c.y2};const x='knob1';const y='knob2';const z='torch';const I=100;let A=0;const B='#000000';const l='#00ff00';const J='#007f00';return q.run=function(){bC.clear(),o(),S(),F(),D(),C(d),k()},q}DiceRoller().run()