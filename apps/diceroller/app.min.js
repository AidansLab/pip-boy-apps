function DiceRoller(){function K(){const n=d[c];const i=n==='D2';const e=30;const g=5;i?(a.x=(b.x1+b.x2)/2,a.y=(b.y1+b.y2)/2):(a.x+=a.vx,a.y+=a.vy,(a.x<b.x1+e+g||a.x>b.x2-e-g)&&(a.vx=-a.vx*s,a.x=Math.max(b.x1+e+g,Math.min(a.x,b.x2-e-g))),(a.y<b.y1+e+g||a.y>b.y2-e-g)&&(a.vy=-a.vy*s,a.y=Math.max(b.y1+e+g,Math.min(a.y,b.y2-e-g))),a.vx*=t,a.vy*=t);const o=Math.sqrt(a.vx*a.vx+a.vy*a.vy);const q=p(n);f&&clearTimeout(f);const r=Math.max(50,600-o*80);f=setTimeout(()=>{k=i?j%2+1:Math.floor(Math.random()*q)+1,m()},r),j++,m(),(j>=40||o<.5)&&(h&&clearInterval(h),f&&clearTimeout(f),i&&j%2===0&&j++,k=i?Math.random()<.5?1:2:Math.floor(Math.random()*q)+1,m(),l=!1)}function L(){h&&clearInterval(h),f&&clearTimeout(f),h=null,f=null}function o(){g.setColor(B),g.fillRect(0,0,v,w)}function C(a){g.setColor(n).drawRect(a.x1,a.y1,a.x2,a.y2)}function m(){g.setColor(B),g.fillRect(i.x,i.y,i.x+i.w,i.y+i.h);const f=60;const b=f/2;const h=d[c];let e=k.toString();const m=h==='D2';const o=j%2;if(g.setColor(n),m)l&&o===0?(g.fillRect(a.x-b,a.y-2,a.x+b,a.y+2),e=''):(g.drawCircle(a.x,a.y,b),e=k===1?'H':'T');else{const c=M(h);const d=[];for(let g=0;g<c;g++){const e=Math.PI/2+g*Math.PI*2/c;d.push([a.x+b*Math.cos(e),a.y+b*Math.sin(e)])}for(let a=0;a<c;a++){const b=d[a];const e=d[(a+1)%c];g.drawLine(b[0],b[1],e[0],e[1])}}if(e){g.setFont('6x8',3),g.setFontAlign(-1,-1,0);const b=g.stringWidth(e);const c=g.getFontHeight();g.drawString(e,a.x-b/2+2,a.y-c/2)}i={x:a.x-b-2,y:a.y-b-2,w:f+4,h:f+4}}function D(){const a=d[c];g.setColor(n).setFontMonofonto23().setFontAlign(1,-1,0).drawString(a,e.x2-5,e.y1+5)}function F(){g.setColor(n).setFontMonofonto23().setFontAlign(-1,-1,0).drawString(r,e.x1+5,e.y1+5);const a=g.stringWidth(r);g.setColor(J).setFontMonofonto16().setFontAlign(-1,-1,0).drawString('v'+G,e.x1+10+a,e.y1+5+8)}function M(a){switch(a){case'D2':return 0;case'D4':return 3;case'D6':return 4;case'D8':return 5;case'D10':return 6;case'D12':return 6;case'D20':return 6;default:return 6}}function p(a){return parseInt(a.substring(1))}function N(e){let a=Date.now();if(a-A<I)return;const b=d[c];if(b==='D2'&&l)return;A=a,R()}function O(a){if(l)return;c+=a,c<0&&(c=d.length-1),c>=d.length&&(c=0),k=Math.floor(Math.random()*p(d[c]))+1,o(),D(),F(),C(b),m()}function P(){L(),o(),Q(),bC.clear(1).flip(),E.reboot()}function Q(){Pip.removeAllListeners(x),Pip.removeAllListeners(y),Pip.removeAllListeners(z)}function R(){l=!0;const b=p(d[c]);k=Math.floor(Math.random()*b)+1,a.vx=(Math.random()*6-3)*u,a.vy=(Math.random()*6-3)*u,j=0,h&&clearInterval(h);const e=d[c]==='D2';const f=e?150:100;h=setInterval(K,f)}function S(){Pip.on(x,N),Pip.on(y,O),Pip.on(z,P)}const q={};const r='Dice Roller';const G='1.1.0';const d=['D2','D4','D6','D8','D10','D12','D20'];const s=.95;const t=.98;const u=8;let c=d.indexOf('D20');let a={x:100,y:100,vx:2,vy:3};let k=1;let f=null;let h=null;let l=!1;let i={x:0,y:0,w:0,h:0};let j=0;const v=g.getWidth();const w=g.getHeight();const e={x1:60,x2:v-60,y1:10,y2:w-10};const H=35;const b={x1:e.x1,x2:e.x2,y1:e.y1+H,y2:e.y2};const x='knob1';const y='knob2';const z='torch';const I=100;let A=0;const B='#000000';const n='#00ff00';const J='#007f00';return q.run=function(){bC.clear(),o(),S(),F(),D(),C(b),m()},q}DiceRoller().run()