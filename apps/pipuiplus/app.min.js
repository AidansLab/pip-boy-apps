function PipUIPlus(){function draw(){g.clear(),g.setFontMonofonto28(),g.setColor(COLOR_THEME),g.setFontAlign(0,-1),g.drawString(APP.name,CENTER,20),g.setFontMonofonto18(),g.setColor(COLOR_THEME_DARK),g.drawString('Options Menu v'+APP.version,CENTER,55);const b=getMenuItems();const a=page*PAGE_SIZE;const c=b.slice(a,a+PAGE_SIZE);const d=26;g.setFontMonofonto16().setFontAlign(-1,-1),c.forEach(function(f,a){const b=100+a*d;const c=50;const e=a===selectedIndex;f.render(c,b,e)}),g.setFontMonofonto16(),g.setColor(COLOR_THEME_DARK),g.setFontAlign(0,-1),g.drawString('Press power button to exit',CENTER,HEIGHT-40)}function getMenuItems(){const a=optionKeys.map(function(a){return{key:a,render:function(d,e,f){const b=options[a]?'X':' ';let c;switch(a){case'enableSpecialTab':{c='[ '+b+' ] Enable STATS > SPECIAL tab';break}case'enablePerksTab':{c='[ '+b+' ] Enable STATS > PERKS tab';break}case'enableRamScan':{c='[ '+b+' ] Enable RAM Scan (bottom right of OS)';break}case'hideCogIcon':{c='[ '+b+' ] Hide Cog Icon (top left of OS)';break}case'hideHolotapeIcon':{c='[ '+b+' ] Hide Holotape Icon (top right of OS)';break}default:c='[ '+b+' ] '+a.charAt(0).toUpperCase()+a.slice(1).replace(/([A-Z])/g,' $1')}f?g.setColor(COLOR_THEME):g.setColor(COLOR_THEME_DARK),g.drawString(c,d,e)},onSelect:function(){options[a]=!options[a];switch(a){case'enableRamScan':{global.ui||(global.ui={}),global.ui.enableRamScan=options[a];break}}saveOptions(),draw()}}});return a.concat(EXTRA_OPTIONS)}function handleLeftKnob(b){let a=Date.now();if(a-lastLeftKnobTime<KNOB_DEBOUNCE)return;lastLeftKnobTime=a,b===0?selectCurrentItem():scrollMenu(b>0?-1:1)}function handleRightKnob(a){scrollMenu(a)}function handlePowerButton(){removeListeners(),inputInterval&&(clearInterval(inputInterval),inputInterval=null),bC.clear(1).flip(),E.reboot()}function handleTopButton(){const a=[1,5,10,15,20];const b=a.findIndex(function(a){return a===Pip.brightness});const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function readOptions(){try{const a=JSON.parse(fs.readFileSync(OPTIONS_PATH));a.enableThemePicker!==undefined&&delete a.enableThemePicker,Object.keys(options).forEach(function(b){a[b]!==undefined&&(options[b]=a[b])}),optionKeys=Object.keys(options),saveOptions()}catch(a){print('[PipUI+] Error reading options:',a),saveOptions()}}function removeListeners(){Pip.removeAllListeners(KNOB_LEFT),Pip.removeAllListeners(KNOB_RIGHT),Pip.removeAllListeners(BTN_TOP),Pip.removeAllListeners(AUDIO_STOPPED)}function setListeners(){Pip.on(KNOB_LEFT,handleLeftKnob),Pip.on(KNOB_RIGHT,handleRightKnob),Pip.on(BTN_TOP,handleTopButton)}function selectCurrentItem(){const b=getMenuItems();const c=page*PAGE_SIZE+selectedIndex;const a=b[c];if(!a)return;a.onSelect()}function saveOptions(){fs.writeFile(OPTIONS_PATH,JSON.stringify(options))}function scrollMenu(e){const a=getMenuItems();const b=page*PAGE_SIZE;const c=a.slice(b,b+PAGE_SIZE).length;const d=Math.floor((a.length-1)/PAGE_SIZE);selectedIndex+=e,selectedIndex<0?page>0?(page--,selectedIndex=PAGE_SIZE-1):selectedIndex=0:selectedIndex>=c&&(page<d?(page++,selectedIndex=0):selectedIndex=c-1),draw()}const self={};const APP=JSON.parse(fs.readFileSync('APPINFO/pipuiplus.info'));const OPTIONS_PATH='USER/PIP_UI_PLUS/options.json';const COLOR_THEME=g.theme.fg;const COLOR_BLACK='#000000';const COLOR_THEME_DARK=g.blendColor(COLOR_BLACK,COLOR_THEME,.5);const HEIGHT=g.getHeight();const WIDTH=g.getWidth();const CENTER=WIDTH/2;const KNOB_LEFT='knob1';const KNOB_RIGHT='knob2';const BTN_TOP='torch';const AUDIO_STOPPED='audioStopped';const KNOB_DEBOUNCE=30;let lastLeftKnobTime=0;let inputInterval=null;let lastPlayButtonState=!1;const PAGE_SIZE=6;let page=0;let selectedIndex=0;let options={enableSpecialTab:!1,enablePerksTab:!1,enableRamScan:!1,hideCogIcon:!1,hideHolotapeIcon:!1};let optionKeys=Object.keys(options);const ICON_OPEN_APP=Graphics.createImage(`
    XXXXXXXXX...XXXXXXXX
    XXXXXXXXX...XXXXXXXX
    XXXXXXXXX...XXXXXXXX
    XXX............XXXXX
    XXX...........XXXXXX
    XXX..........XXX.XXX
    XXX.........XXX..XXX
    XXX........XXX...XXX
    XXX.......XXX.......
    XXX......XXX........
    XXX.....XXX.........
    XXX....XXX.......XXX
    XXX...XXX........XXX
    XXX..............XXX
    XXX..............XXX
    XXX..............XXX
    XXX..............XXX
    XXXXXXXXXXXXXXXXXXXX
    XXXXXXXXXXXXXXXXXXXX
    XXXXXXXXXXXXXXXXXXXX
  `);const EXTRA_OPTIONS=[{key:'openThemePicker',render:function(a,b,c){c?g.setColor(COLOR_THEME):g.setColor(COLOR_THEME_DARK),g.drawImage(ICON_OPEN_APP,a+6,b),g.drawString('Open Advanced Theme Picker',a+ICON_OPEN_APP.width+24,b)},onSelect:function(){removeListeners(),inputInterval&&(clearInterval(inputInterval),inputInterval=null),print('[PipUI+] Loading Theme Picker...');try{g.clear(),eval(fs.readFile('USER_BOOT/PIP_UI_PLUS/ThemePicker.min.js'))}catch(a){print('[PipUI+] Error loading Theme Picker:',a)}}}];return self.run=function(){bC.clear(),global.ui&&global.ui.enableRamScan&&(global.ui.enableRamScan=!1),removeListeners(),setListeners(),readOptions(),draw(),inputInterval=setInterval(function(){const a=BTN_PLAY.read();a&&!lastPlayButtonState&&selectCurrentItem(),lastPlayButtonState=a},100),setWatch(function(){handlePowerButton()},BTN_POWER,{debounce:50,edge:'rising',repeat:!0})},self}PipUIPlus().run()