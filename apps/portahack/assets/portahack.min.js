function PortaHack(){function T(){a.setColor(p).fillRect(0,0,A,B)}function U(){if(m<0||m>H)throw new Error('Invalid number of attempts remaining: '+m);a.setColor(p).fillRect(v);const b=Q.padding;const g=Q.textHeight;const c=v.y1+g+b;let e=m+' ATTEMPT(S) LEFT:';a.setColor(j).setFont(G).setFontAlign(-1,-1).drawString(e,v.x1+b,c);const d=8;const f=5;const h=v.x1+b+a.stringWidth(e)+f;for(let i=0;i<m;i++){const b=h+i*(d+f);a.setColor(j).fillRect(b,c,b+d,c+d)}}function t(b){if(!X)return;a.setColor(ac).drawRect(b)}function af(){function a(a,c){a.forEach((d,e)=>{const a=d.line;for(let f=0;f<a.length;f++){const g=a[f];const d=b[g];if(!d)continue;for(let b=f+1;b<Math.min(f+7,a.length);b++)if(a[b]===d){z.push({row:e+c,startCol:f,endCol:b});break}}})}z=[];const b={'(':')','{':'}','[':']','<':'>'};a(l,0),a(n,k)}function h(){const r=7;const i=b<k;const f=i?w:y;const s=i?0:k;const u=i?l[b]:n[b-s];const m=u.line;const d=f.y1+(b-s)*10;if(h.prevRow!==undefined&&h.prevCol!==undefined){const c=h.prevRow<k;const b=c?w:y;const e=c?0:k;const f=c?l[h.prevRow]:n[h.prevRow-e];const d=b.y1+(h.prevRow-e)*10;const g='0xF'+(2404+h.prevRow).toString(16).padStart(3,'0');a.setColor(p).fillRect(b.x1,d,b.x2,d+10).setColor(j).setFont(G).setFontAlign(-1,-1).drawString(g+' '+f.line,b.x1+2,d)}h.prevRow=b,h.prevCol=c;const x='0xF'+(2404+b).toString(16).padStart(3,'0');a.setColor(j).setFont(G).setFontAlign(-1,-1).drawString(x+' '+m,f.x1+2,d);const e=z.find(a=>a.row===b&&c>=a.startCol&&c<=a.endCol);if(e){const b=f.x1+2+(r+e.startCol)*6;const c=(e.endCol-e.startCol+1)*6;a.setColor(j).fillRect(b,d,b+c,d+10).setColor(p).drawString(m.substring(e.startCol,e.endCol+1),b,d);return}const A=i?o[b]:q[b-s];const g=u.embedAt;const t=A.length;const v=m.substr(g,t);const B=/^\.+$/.test(v);if(g>=0&&c>=g&&c<g+t&&!B){const b=f.x1+2+(r+g)*6;a.setColor(j).fillRect(b,d,b+t*6,d+10).setColor(p).drawString(v,b,d)}else{const b=f.x1+2+(r+c)*6;a.setColor(j).fillRect(b,d,b+6,d+10).setColor(p).drawString(m[c],b,d)}}function ag(){a6()}function a6(){J=!0,I=Date.now()+1e3,T(),L();const c='LOCKOUT INITIATED';a.setColor(j).setFontMonofonto18().setFontAlign(-1,-1).drawString(c,(A-a.stringWidth(c))/2,B/3);const d='Press radio button to retry or power to exit';a.setColor(Y).setFontMonofonto16().setFontAlign(-1,-1).drawString(d,(A-a.stringWidth(d))/2,B/3+30),f&&(clearInterval(f),f=null);let b=!1;f=setInterval(()=>{Date.now()>=I&&BTN_PLAY.read()?b||(b=!0,clearInterval(f),f=null,a8()):b=!1},N)}function ah(){a.setColor(p).fillRect(C);const b='ROBCO INDUSTRIES (TM) '+aa+' v'+ab+' PROTOCOL';a.setColor(j).setFont(G).setFontAlign(-1,-1).drawString(b.toUpperCase(),C.x1+O.padding,C.y1+O.padding)}function K(){const c=10;const e=Math.floor((r.y2-r.y1)/c);const b=d.slice(-e);a.setColor(p).fillRect(r),a.setFont('6x8').setFontAlign(-1,-1);for(let d=0;d<b.length;d++){const e=r.y2-c*(b.length-d);const f=b[d];a.setColor(j).drawString(f,r.x1+2,e)}}function a7(d,b,e,f){const c=10;a.setFont('6x8').setFontAlign(-1,-1);for(let g=0;g<d.length;g++){const h='0xF'+(e+g).toString(16).padStart(3,'0');const d=f[g];if(!d||(typeof d.line)[1]!='t'){const a=`Invalid junk line at ${g}: ${JSON.stringify(d)}`;throw new Error(a)}const i=d.line;const k=b.y1+g*c;a.setColor(j).drawString(h+' '+i,b.x1+2,k)}}function V(){a.setColor(p).fillRect(D);let b='';m<=0?(b='!!! ACCESS DENIED !!!    REBOOTING...',setTimeout(function(){ag()},3500)):m===1?b='!!! WARNING: LOCKOUT IMMINENT !!!':b='ENTER PASSWORD NOW',a.setColor(j).setFont(G).setFontAlign(-1,-1).drawString(b,D.x1+P.padding,D.y1+P.padding)}function ai(){J=!0,I=Date.now()+1e3,T(),L();const c='ACCESS GRANTED';a.setColor(j).setFontMonofonto18().setFontAlign(-1,-1).drawString(c,(A-a.stringWidth(c))/2,B/3);const d='Press radio to restart or power to exit';a.setColor(Y).setFontMonofonto16().setFontAlign(-1,-1).drawString(d,(A-a.stringWidth(d))/2,B/3+30),f&&(clearInterval(f),f=null);let b=!1;f=setInterval(()=>{Date.now()>=I&&BTN_PLAY.read()?b||(b=!0,clearInterval(f),f=null,a8()):b=!1},N)}function aj(d){let a=Date.now();if(a-a3<a2)return;if(a3=a,d===0)W();else{b=(b+(d<0?1:-1)+R)%R;const a=b<k;const f=a?0:k;const e=a?l[b]:n[b-f];const g=a?o[b]:q[b-f];c>=e.embedAt&&c<e.embedAt+g.length&&(c=e.embedAt),h()}}function ak(){const a=BTN_PLAY.read();const b=Date.now();a&&!a5&&b-a4>=a2&&(a4=b,J||W()),a5=a}function al(){L(),u&&clearInterval(u),bC.clear(1).flip(),E.reboot()}function am(e){if(e===0){W();return}const d=b<k;const a=d?b:b-k;const m=d?l[a]:n[a];const p=d?o[a]:q[a];const f=m.line.length;const g=m.embedAt;let i=1;c>=g&&c<g+p.length&&(e>0?i=Math.max(1,g+p.length-c):i=Math.max(1,c-g));let j=c+(e>0?i:-i);if(e>0&&d&&j>=f){b=a+k,c=0,h();return}if(e<0&&!d&&j<0){b=a,c=l[a].line.length-1,h();return}c=(j%f+f)%f,h()}function an(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function ao(){const a=[];if(o.forEach((c,e)=>{if(c===i)return;const b=l[e];if(!b||(typeof b.line)[1]!='t')return;const d=b.embedAt;if(d<0||d+c.length>b.line.length)return;/^\.+$/.test(b.line.substr(d,c.length))||a.push({side:'L',row:e,word:c})}),q.forEach((c,e)=>{if(c===i)return;const b=n[e];if(!b||(typeof b.line)[1]!='t')return;const d=b.embedAt;if(d<0||d+c.length>b.line.length)return;/^\.+$/.test(b.line.substr(d,c.length))||a.push({side:'R',row:e,word:c})}),a.length===0)return null;const b=a[Math.random()*a.length|0];const g=b.side==='L'?l:n;const c=g[b.row];const d=c.embedAt;const e=b.word.length;const f=c.line;return c.line=f.slice(0,d)+'.'.repeat(e)+f.slice(d+e),b}function L(){Pip.removeAllListeners($),Pip.removeAllListeners(a0),Pip.removeAllListeners(a1)}function a8(){f&&(clearInterval(f),f=null),u&&(clearInterval(u),u=null),J=!1,c=0,b=0,m=H,s=null,d=[],l=[],n=[],i=null,h.prevRow=undefined,h.prevCol=undefined,M.run()}function ap(c){let b;if(Math.random()<.5?(m=H,d.push('> TRIES RESET'),U(),V()):(b=ao(),d.push('> DUD REMOVED')),K(),b){const e=b.side==='L';const c=e?w:y;const d=b.row;const h=e?2404:2608;const i='0xF'+(h+d).toString(16).padStart(3,'0');const g=10;const f=c.y1+d*g;a.setColor(p).fillRect(c.x1,f,c.x2,f+g);const k=e?l[d].line:n[d].line;a.setColor(j).setFont('6x8').setFontAlign(-1,-1).drawString(i+' '+k,c.x1+2,f)}h(),t(w),t(y),z=z.filter(a=>a!==c)}function W(){const j=z.find(a=>a.row===b&&c>=a.startCol&&c<=a.endCol);if(j){ap(j);return}const g=b<k;const h=g?b:b-k;const a=g?l[h]:n[h];const u=g?o:q;const p=u[h];if(!a||(typeof a.line)[1]!='t'||(typeof a.embedAt)[0]!='n'){console.error('select(): invalid junk at row',b,a);return}const f=a.embedAt;const t=a.line;const e=t.slice(f,f+p.length);const v=/^\.+$/.test(e);const w=!v&&c>=f&&c<f+p.length;if(d.length===1&&d[0]==='> . '&&d.pop(),m<=0){a6();return}if(w){s=e;const a=d.findIndex(a=>a==='> '+s);if(a!==-1){const b=d[a+1];d.push('> '+s),b&&b.startsWith('>')&&d.push(b)}else{if(s===i){d.push('> '+s),d.push('> ACCESS GRANTED'),K(),ai();return}let a=0;if(e.length===i.length)for(let b=0;b<e.length;b++)e[b]===i[b]&&a++;const b=Math.floor((r.y2-r.y1)/10)-1;while(d.length>b)d.shift();d.push('> '+s),d.push(`> ${a}/${i.length} correct.`),m--,U(),V(),m===0&&d.push('> Entry denied')}}else{s=t[c];const a=Math.floor((r.y2-r.y1)/10);d.length>=a&&d.shift(),d.push('> ['+s+']')}K()}function aq(a){for(let b=a.length-1;b>0;b--){let c=Math.random()*(b+1)|0;let d=a[b];a[b]=a[c],a[c]=d}}function ar(){Pip.on($,aj),Pip.on(a0,am),Pip.on(a1,an)}function F(b,c){const a='{}[]<>?/\\|!@#$%^&*()-_=+;:"\',.`~';if(!c){let c='';for(let f=0;f<b;f++)c+=a[Math.random()*a.length|0];return{line:c,embedAt:b}}let d='';const e=Math.random()*(b-c.length)|0;for(let f=0;f<b;f++)f===e?(d+=c,f+=c.length-1):d+=a[Math.random()*a.length|0];return{line:d,embedAt:e}}function as(){const b=o.concat(q);i=b[Math.floor(Math.random()*b.length)];const a=o.includes(i)?'L':'R';const c=a==='L'?o.indexOf(i):q.indexOf(i);const d=.4;l=o.map((b,e)=>(a==='L'&&e===c?(F(12,i)):(Math.random())<d?(F(12,'')):(F(12,b)))),n=q.map((b,e)=>(a==='R'&&e===c?(F(12,i)):(Math.random())<d?(F(12,'')):(F(12,b))))}function a9(){const a=o.concat(q);i=a[Math.floor(Math.random()*a.length)],Pip.removeAllListeners(Z),ah(),V(),U(),as(),af(),a7(o,w,2404,l),a7(q,y,2608,n),t(e),t(C),t(D),t(v),t(w),t(y),t(r),d=['> . '],K(),ar(),f&&clearInterval(f),u&&clearInterval(u),u=setInterval(ak,N)}const M={};const aa='Porta Hack';const ab='1.2.0';const X=!1;const N=16.666666666666668;const H=4;let m=H;let i=null;let c=0;let b=0;let I=0;let J=!1;let l=[];let n=[];let s=null;let z=[];let u=null;let f=null;const x=8;const G='6x'+x;const a=g;const A=g.getWidth();const B=g.getHeight();const e={x1:60,x2:A-60,y1:10,y2:B-10};const O={height:x+4,padding:2,textHeight:x};const C={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y1+O.height};const P={height:x+4,padding:2,textHeight:x};const D={x1:e.x1,x2:e.x2,y1:C.y2,y2:C.y2+P.height};const Q={height:x*3+2+2,padding:2,textHeight:x};const v={x1:e.x1,x2:e.x2,y1:D.y2,y2:D.y2+Q.height};const w={x1:e.x1,x2:e.x1+(e.x2-e.x1)*.35,y1:v.y2,y2:e.y2};const y={x1:w.x2,x2:w.x2+(e.x2-e.x1)*.35,y1:v.y2,y2:e.y2};const r={x1:y.x2,x2:e.x2,y1:v.y2,y2:e.y2};let d=[];const p='#000000';const ac='#ffffff';const j=g.theme.fg;const Y=g.blendColor(p,j,.5);const Z='videoStopped';const ad='USER/PORTA_HACK/STARTHACK.avi';const ae=['STORY','SYNOPSIS','THE','PLAYER','CHARACTER','PC','STUMBLES','ONTO','PLOT','BUILD','HYPERLIGHT','TRANSMITTER','THAT','WILL','BE','USED','COMMAND','FORGOTTEN','ORBITAL','WEAPONS','PLATFORM','MYSTERIOUS','WASTELORD','WITH','MESSIANIC','COMPLEX','KNOWN','AS','PUPPETMASTER','FOR','HIS','ABILITY','CONTROL','MINDS','OF','DANGEROUS','MONSTERS','HAS','SENT','ARMIES','SCOUR','WASTES','PIECES','TECHNOLOGY','IN','ORDER','BUILDER','ABLE','HARNESS','AWESOME','DESTRUCTIVE','POWER','AND','BECOME','ABSOLUTE','RULER','IS','TOSSED','INTO','MIDDLE','CONFLICT','WHEN','RAIDERS','KIDNAP','ENSLAVE','KINDLY','VILLAGERS','WHO','HAVE','SAVED','LIFE','AT','START','GAME','STRUGGLES','FIND','FREE','HE','UNCOVERS','MUST','ACT','STOP','DISCOVER','WAY','THWART','PLANS','BY','UNLOCKING','SECRET','ANDROID','CITIZENS','MAYVILLE','AI','CONTROLS','THEM','HIDDEN','DEEP','BENEATH','CORE','OFFERS','HELP','BEFORE','CAN','COMPLETE','FORGES','AN','UNLIKELY','ALLIANCE','BETWEEN','CITY','MUTANTS','GROUP','SCIENTISTS','SURVIVORS','FROM','BASE','RACE','AGAINST','FORCES','PARTS'];const k=25;const R=k*2;const S=ae.slice();aq(S);const o=S.slice(0,k);const q=S.slice(k,R);const _=o.concat(q);i=_[Math.floor(Math.random()*_.length)];const $='knob1';const a0='knob2';const a1='torch';const a2=100;let a3=0;let a4=0;let a5=!1;return M.run=function(){if(!(a&&bC))throw new Error('Pip-Boy graphics not available!');bC.clear(),T(),L(),setWatch(()=>al(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0}),X?a9():(Pip.videoStart(ad,{x:40}),Pip.on(Z,a9))},M}PortaHack().run()