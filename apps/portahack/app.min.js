function PortaHack(){function T(){a.setColor(r).fillRect(0,0,A,B)}function U(){if(m<0||m>H)throw new Error('Invalid number of attempts remaining: '+m);a.setColor(r).fillRect(v);const b=Q.padding;const g=Q.textHeight;const c=v.y1+g+b;let e=m+' ATTEMPT(S) LEFT:';a.setColor(k).setFont(G).setFontAlign(-1,-1).drawString(e,v.x1+b,c);const d=8;const f=5;const h=v.x1+b+a.stringWidth(e)+f;for(let i=0;i<m;i++){const b=h+i*(d+f);a.setColor(k).fillRect(b,c,b+d,c+d)}}function t(b){if(!X)return;a.setColor(ac).drawRect(b)}function af(){function a(a,c){a.forEach((d,e)=>{const a=d.line;for(let f=0;f<a.length;f++){const g=a[f];const d=b[g];if(!d)continue;for(let b=f+1;b<Math.min(f+7,a.length);b++)if(a[b]===d){z.push({row:e+c,startCol:f,endCol:b});break}}})}z=[];const b={'(':')','{':'}','[':']','<':'>'};a(l,0),a(n,i)}function h(){const q=7;const j=b<i;const f=j?w:y;const s=j?0:i;const u=j?l[b]:n[b-s];const m=u.line;const d=f.y1+(b-s)*10;if(h.prevRow!==undefined&&h.prevCol!==undefined){const c=h.prevRow<i;const b=c?w:y;const e=c?0:i;const f=c?l[h.prevRow]:n[h.prevRow-e];const d=b.y1+(h.prevRow-e)*10;const g='0xF'+(2404+h.prevRow).toString(16).padStart(3,'0');a.setColor(r).fillRect(b.x1,d,b.x2,d+10).setColor(k).setFont(G).setFontAlign(-1,-1).drawString(g+' '+f.line,b.x1+2,d)}h.prevRow=b,h.prevCol=c;const x='0xF'+(2404+b).toString(16).padStart(3,'0');a.setColor(k).setFont(G).setFontAlign(-1,-1).drawString(x+' '+m,f.x1+2,d);const e=z.find(a=>a.row===b&&c>=a.startCol&&c<=a.endCol);if(e){const b=f.x1+2+(q+e.startCol)*6;const c=(e.endCol-e.startCol+1)*6;a.setColor(k).fillRect(b,d,b+c,d+10).setColor(r).drawString(m.substring(e.startCol,e.endCol+1),b,d);return}const A=j?o[b]:p[b-s];const g=u.embedAt;const t=A.length;const v=m.substr(g,t);const B=/^\.+$/.test(v);if(g>=0&&c>=g&&c<g+t&&!B){const b=f.x1+2+(q+g)*6;a.setColor(k).fillRect(b,d,b+t*6,d+10).setColor(r).drawString(v,b,d)}else{const b=f.x1+2+(q+c)*6;a.setColor(k).fillRect(b,d,b+6,d+10).setColor(r).drawString(m[c],b,d)}}function ag(){a6()}function a6(){J=!0,I=Date.now()+1e3,T(),L();const c='LOCKOUT INITIATED';a.setColor(k).setFontMonofonto18().setFontAlign(-1,-1).drawString(c,(A-a.stringWidth(c))/2,B/3);const d='Press radio button to retry or power to exit';a.setColor(Y).setFontMonofonto16().setFontAlign(-1,-1).drawString(d,(A-a.stringWidth(d))/2,B/3+30),f&&(clearInterval(f),f=null);let b=!1;f=setInterval(()=>{Date.now()>=I&&BTN_PLAY.read()?b||(b=!0,clearInterval(f),f=null,a8()):b=!1},N)}function ah(){a.setColor(r).fillRect(C);const b='ROBCO INDUSTRIES (TM) '+aa+' v'+ab+' PROTOCOL';a.setColor(k).setFont(G).setFontAlign(-1,-1).drawString(b.toUpperCase(),C.x1+O.padding,C.y1+O.padding)}function K(){const c=10;const e=Math.floor((q.y2-q.y1)/c);const b=d.slice(-e);a.setColor(r).fillRect(q),a.setFont('6x8').setFontAlign(-1,-1);for(let d=0;d<b.length;d++){const e=q.y2-c*(b.length-d);const f=b[d];a.setColor(k).drawString(f,q.x1+2,e)}}function a7(d,b,e,f){const c=10;a.setFont('6x8').setFontAlign(-1,-1);for(let g=0;g<d.length;g++){const h='0xF'+(e+g).toString(16).padStart(3,'0');const d=f[g];if(!d||(typeof d.line)[1]!='t'){const a=`Invalid junk line at ${g}: ${JSON.stringify(d)}`;throw new Error(a)}const i=d.line;const j=b.y1+g*c;a.setColor(k).drawString(h+' '+i,b.x1+2,j)}}function V(){a.setColor(r).fillRect(D);let b='';m<=0?(b='!!! ACCESS DENIED !!!    REBOOTING...',setTimeout(function(){ag()},3500)):m===1?b='!!! WARNING: LOCKOUT IMMINENT !!!':b='ENTER PASSWORD NOW',a.setColor(k).setFont(G).setFontAlign(-1,-1).drawString(b,D.x1+P.padding,D.y1+P.padding)}function ai(){J=!0,I=Date.now()+1e3,T(),L();const c='ACCESS GRANTED';a.setColor(k).setFontMonofonto18().setFontAlign(-1,-1).drawString(c,(A-a.stringWidth(c))/2,B/3);const d='Press radio to restart or power to exit';a.setColor(Y).setFontMonofonto16().setFontAlign(-1,-1).drawString(d,(A-a.stringWidth(d))/2,B/3+30),f&&(clearInterval(f),f=null);let b=!1;f=setInterval(()=>{Date.now()>=I&&BTN_PLAY.read()?b||(b=!0,clearInterval(f),f=null,a8()):b=!1},N)}function aj(d){let a=Date.now();if(a-a3<a2)return;if(a3=a,d===0)W();else{b=(b+(d<0?1:-1)+R)%R;const a=b<i;const f=a?0:i;const e=a?l[b]:n[b-f];const g=a?o[b]:p[b-f];c>=e.embedAt&&c<e.embedAt+g.length&&(c=e.embedAt),h()}}function ak(){const a=BTN_PLAY.read();const b=Date.now();a&&!a5&&b-a4>=a2&&(a4=b,J||W()),a5=a}function al(){L(),u&&clearInterval(u),bC.clear(1).flip(),E.reboot()}function am(e){if(e===0){W();return}const d=b<i;const a=d?b:b-i;const m=d?l[a]:n[a];const q=d?o[a]:p[a];const f=m.line.length;const g=m.embedAt;let j=1;c>=g&&c<g+q.length&&(e>0?j=Math.max(1,g+q.length-c):j=Math.max(1,c-g));let k=c+(e>0?j:-j);if(e>0&&d&&k>=f){b=a+i,c=0,h();return}if(e<0&&!d&&k<0){b=a,c=l[a].line.length-1,h();return}c=(k%f+f)%f,h()}function an(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function ao(){const a=[];if(o.forEach((c,e)=>{if(c===j)return;const b=l[e];if(!b||(typeof b.line)[1]!='t')return;const d=b.embedAt;if(d<0||d+c.length>b.line.length)return;/^\.+$/.test(b.line.substr(d,c.length))||a.push({side:'L',row:e,word:c})}),p.forEach((c,e)=>{if(c===j)return;const b=n[e];if(!b||(typeof b.line)[1]!='t')return;const d=b.embedAt;if(d<0||d+c.length>b.line.length)return;/^\.+$/.test(b.line.substr(d,c.length))||a.push({side:'R',row:e,word:c})}),a.length===0)return null;const b=a[Math.random()*a.length|0];const g=b.side==='L'?l:n;const c=g[b.row];const d=c.embedAt;const e=b.word.length;const f=c.line;return c.line=f.slice(0,d)+'.'.repeat(e)+f.slice(d+e),b}function L(){Pip.removeAllListeners($),Pip.removeAllListeners(a0),Pip.removeAllListeners(a1)}function a8(){f&&(clearInterval(f),f=null),u&&(clearInterval(u),u=null),J=!1,c=0,b=0,m=H,s=null,d=[],l=[],n=[],j=null,h.prevRow=undefined,h.prevCol=undefined,M.run()}function ap(c){let b;if(Math.random()<.5?(m=H,d.push('> TRIES RESET'),U(),V()):(b=ao(),d.push('> DUD REMOVED')),K(),b){const e=b.side==='L';const c=e?w:y;const d=b.row;const h=e?2404:2608;const i='0xF'+(h+d).toString(16).padStart(3,'0');const g=10;const f=c.y1+d*g;a.setColor(r).fillRect(c.x1,f,c.x2,f+g);const j=e?l[d].line:n[d].line;a.setColor(k).setFont('6x8').setFontAlign(-1,-1).drawString(i+' '+j,c.x1+2,f)}h(),t(w),t(y),z=z.filter(a=>a!==c)}function W(){const k=z.find(a=>a.row===b&&c>=a.startCol&&c<=a.endCol);if(k){ap(k);return}const g=b<i;const h=g?b:b-i;const a=g?l[h]:n[h];const u=g?o:p;const r=u[h];if(!a||(typeof a.line)[1]!='t'||(typeof a.embedAt)[0]!='n'){console.error('select(): invalid junk at row',b,a);return}const f=a.embedAt;const t=a.line;const e=t.slice(f,f+r.length);const v=/^\.+$/.test(e);const w=!v&&c>=f&&c<f+r.length;if(d.length===1&&d[0]==='> . '&&d.pop(),m<=0){a6();return}if(w){s=e;const a=d.findIndex(a=>a==='> '+s);if(a!==-1){const b=d[a+1];d.push('> '+s),b&&b.startsWith('>')&&d.push(b)}else{if(s===j){d.push('> '+s),d.push('> ACCESS GRANTED'),K(),ai();return}let a=0;if(e.length===j.length)for(let b=0;b<e.length;b++)e[b]===j[b]&&a++;const b=Math.floor((q.y2-q.y1)/10)-1;while(d.length>b)d.shift();d.push('> '+s),d.push(`> [${a}]`),m--,U(),V(),m===0&&d.push('> Entry denied')}}else{s=t[c];const a=Math.floor((q.y2-q.y1)/10);d.length>=a&&d.shift(),d.push('> ['+s+']')}K()}function aq(b){for(var a=b.length-1;a>0;a--){var c=Math.random()*(a+1)|0,d=b[a];b[a]=b[c],b[c]=d}}function ar(){Pip.on($,aj),Pip.on(a0,am),Pip.on(a1,an)}function F(b,c){const a='{}[]<>?/\\|!@#$%^&*()-_=+;:"\',.`~';if(!c){let c='';for(let f=0;f<b;f++)c+=a[Math.random()*a.length|0];return{line:c,embedAt:b}}let d='';const e=Math.random()*(b-c.length)|0;for(let f=0;f<b;f++)f===e?(d+=c,f+=c.length-1):d+=a[Math.random()*a.length|0];return{line:d,embedAt:e}}function as(){const b=o.concat(p);j=b[Math.floor(Math.random()*b.length)];const a=o.includes(j)?'L':'R';const c=a==='L'?o.indexOf(j):p.indexOf(j);const d=.4;l=o.map((b,e)=>(a==='L'&&e===c?(F(12,j)):(Math.random())<d?(F(12,'')):(F(12,b)))),n=p.map((b,e)=>(a==='R'&&e===c?(F(12,j)):(Math.random())<d?(F(12,'')):(F(12,b))))}function a9(){const a=o.concat(p);j=a[Math.floor(Math.random()*a.length)],Pip.removeAllListeners(Z),ah(),V(),U(),as(),af(),a7(o,w,2404,l),a7(p,y,2608,n),t(e),t(C),t(D),t(v),t(w),t(y),t(q),d=['> . '],K(),ar(),f&&clearInterval(f),u&&clearInterval(u),u=setInterval(ak,N)}const M={};const aa='Porta Hack';const ab='1.1.0';const X=!1;const N=16.666666666666668;const H=4;let m=H;let j=null;let c=0;let b=0;let I=0;let J=!1;let l=[];let n=[];let s=null;let z=[];let u=null;let f=null;const x=8;const G='6x'+x;const a=g;const A=g.getWidth();const B=g.getHeight();const e={x1:60,x2:A-60,y1:10,y2:B-10};const O={height:x+4,padding:2,textHeight:x};const C={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y1+O.height};const P={height:x+4,padding:2,textHeight:x};const D={x1:e.x1,x2:e.x2,y1:C.y2,y2:C.y2+P.height};const Q={height:x*3+2+2,padding:2,textHeight:x};const v={x1:e.x1,x2:e.x2,y1:D.y2,y2:D.y2+Q.height};const w={x1:e.x1,x2:e.x1+(e.x2-e.x1)*.35,y1:v.y2,y2:e.y2};const y={x1:w.x2,x2:w.x2+(e.x2-e.x1)*.35,y1:v.y2,y2:e.y2};const q={x1:y.x2,x2:e.x2,y1:v.y2,y2:e.y2};let d=[];const r='#000000';const ac='#ffffff';const k='#00ff00';const Y='#007f00';const at='#003300';const Z='videoStopped';const ad='USER/PORTAHACK/STARTHACK.avi';const ae=['STORY','SYNOPSIS','THE','PLAYER','CHARACTER','PC','STUMBLES','ONTO','PLOT','BUILD','HYPERLIGHT','TRANSMITTER','THAT','WILL','BE','USED','COMMAND','FORGOTTEN','ORBITAL','WEAPONS','PLATFORM','MYSTERIOUS','WASTELORD','WITH','MESSIANIC','COMPLEX','KNOWN','AS','PUPPETMASTER','FOR','HIS','ABILITY','CONTROL','MINDS','OF','DANGEROUS','MONSTERS','HAS','SENT','ARMIES','SCOUR','WASTES','PIECES','TECHNOLOGY','IN','ORDER','BUILDER','ABLE','HARNESS','AWESOME','DESTRUCTIVE','POWER','AND','BECOME','ABSOLUTE','RULER','IS','TOSSED','INTO','MIDDLE','CONFLICT','WHEN','RAIDERS','KIDNAP','ENSLAVE','KINDLY','VILLAGERS','WHO','HAVE','SAVED','LIFE','AT','START','GAME','STRUGGLES','FIND','FREE','HE','UNCOVERS','MUST','ACT','STOP','DISCOVER','WAY','THWART','PLANS','BY','UNLOCKING','SECRET','ANDROID','CITIZENS','MAYVILLE','AI','CONTROLS','THEM','HIDDEN','DEEP','BENEATH','CORE','OFFERS','HELP','BEFORE','CAN','COMPLETE','FORGES','AN','UNLIKELY','ALLIANCE','BETWEEN','CITY','MUTANTS','GROUP','SCIENTISTS','SURVIVORS','FROM','BASE','RACE','AGAINST','FORCES','PARTS'];const i=25;const R=i*2;const S=ae.slice();aq(S);const o=S.slice(0,i);const p=S.slice(i,R);const _=o.concat(p);j=_[Math.floor(Math.random()*_.length)];const $='knob1';const a0='knob2';const a1='torch';const a2=100;let a3=0;let a4=0;let a5=!1;return M.run=function(){if(!(a&&bC))throw new Error('Pip-Boy graphics not available!');bC.clear(),T(),L(),setWatch(()=>al(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0}),X?a9():(Pip.videoStart(ad,{x:40}),Pip.on(Z,a9))},M}PortaHack().run()