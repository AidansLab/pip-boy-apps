function PortaHack(){function U(){a.setColor(r).fillRect(0,0,A,B)}function V(){if(o<0||o>H)throw new Error('Invalid number of attempts remaining: '+o);a.setColor(r).fillRect(v);const b=Q.padding;const g=Q.textHeight;const c=v.y1+g+b;let e=o+' ATTEMPT(S) LEFT:';a.setColor(l).setFont(G).setFontAlign(-1,-1).drawString(e,v.x1+b,c);const d=8;const f=5;const h=v.x1+b+a.stringWidth(e)+f;for(let i=0;i<o;i++){const b=h+i*(d+f);a.setColor(l).fillRect(b,c,b+d,c+d)}}function t(b){if(!Y)return;a.setColor(ad).drawRect(b)}function ah(){function a(a,c){a.forEach((d,e)=>{const a=d.line;for(let f=0;f<a.length;f++){const g=a[f];const d=b[g];if(!d)continue;for(let b=f+1;b<Math.min(f+7,a.length);b++)if(a[b]===d){z.push({row:e+c,startCol:f,endCol:b});break}}})}z=[];const b={'(':')','{':'}','[':']','<':'>'};a(m,0),a(p,k)}function j(){const q=7;const h=b<k;const f=h?w:y;const s=h?0:k;const u=h?m[b]:p[b-s];const o=u.line;const d=f.y1+(b-s)*10;if(j.prevRow!==undefined&&j.prevCol!==undefined){const c=j.prevRow<k;const b=c?w:y;const e=c?0:k;const f=c?m[j.prevRow]:p[j.prevRow-e];const d=b.y1+(j.prevRow-e)*10;const g='0xF'+(2404+j.prevRow).toString(16).padStart(3,'0');a.setColor(r).fillRect(b.x1,d,b.x2,d+10).setColor(l).setFont(G).setFontAlign(-1,-1).drawString(g+' '+f.line,b.x1+2,d)}j.prevRow=b,j.prevCol=c;const x='0xF'+(2404+b).toString(16).padStart(3,'0');a.setColor(l).setFont(G).setFontAlign(-1,-1).drawString(x+' '+o,f.x1+2,d);const e=z.find(a=>a.row===b&&c>=a.startCol&&c<=a.endCol);if(e){const b=f.x1+2+(q+e.startCol)*6;const c=(e.endCol-e.startCol+1)*6;a.setColor(l).fillRect(b,d,b+c,d+10).setColor(r).drawString(o.substring(e.startCol,e.endCol+1),b,d);return}const A=h?i[b]:n[b-s];const g=u.embedAt;const t=A.length;const v=o.substr(g,t);const B=/^\.+$/.test(v);if(g>=0&&c>=g&&c<g+t&&!B){const b=f.x1+2+(q+g)*6;a.setColor(l).fillRect(b,d,b+t*6,d+10).setColor(r).drawString(v,b,d)}else{const b=f.x1+2+(q+c)*6;a.setColor(l).fillRect(b,d,b+6,d+10).setColor(r).drawString(o[c],b,d)}}function ai(){a7()}function a7(){J=!0,I=Date.now()+1e3,U(),L();const c='LOCKOUT INITIATED';a.setColor(l).setFontMonofonto18().setFontAlign(-1,-1).drawString(c,(A-a.stringWidth(c))/2,B/3);const d='Press radio button to retry or power to exit';a.setColor(Z).setFontMonofonto16().setFontAlign(-1,-1).drawString(d,(A-a.stringWidth(d))/2,B/3+30),h&&(clearInterval(h),h=null);let b=!1;h=setInterval(()=>{Date.now()>=I&&BTN_PLAY.read()?b||(b=!0,clearInterval(h),h=null,a9()):b=!1},N)}function aj(){a.setColor(r).fillRect(C);const b='ROBCO INDUSTRIES (TM) '+ab+' v'+ac+' PROTOCOL';a.setColor(l).setFont(G).setFontAlign(-1,-1).drawString(b.toUpperCase(),C.x1+O.padding,C.y1+O.padding)}function K(){const c=10;const e=Math.floor((q.y2-q.y1)/c);const b=d.slice(-e);a.setColor(r).fillRect(q),a.setFont('6x8').setFontAlign(-1,-1);for(let d=0;d<b.length;d++){const e=q.y2-c*(b.length-d);const f=b[d];a.setColor(l).drawString(f,q.x1+2,e)}}function a8(d,b,e,f){const c=10;a.setFont('6x8').setFontAlign(-1,-1);for(let g=0;g<d.length;g++){const h='0xF'+(e+g).toString(16).padStart(3,'0');const d=f[g];if(!d||(typeof d.line)[1]!='t'){const a=`Invalid junk line at ${g}: ${JSON.stringify(d)}`;throw new Error(a)}const i=d.line;const j=b.y1+g*c;a.setColor(l).drawString(h+' '+i,b.x1+2,j)}}function W(){a.setColor(r).fillRect(D);let b='';o<=0?(b='!!! ACCESS DENIED !!!    REBOOTING...',setTimeout(function(){ai()},3500)):o===1?b='!!! WARNING: LOCKOUT IMMINENT !!!':b='ENTER PASSWORD NOW',a.setColor(l).setFont(G).setFontAlign(-1,-1).drawString(b,D.x1+P.padding,D.y1+P.padding)}function ak(){J=!0,I=Date.now()+1e3,U(),L();const c='ACCESS GRANTED';a.setColor(l).setFontMonofonto18().setFontAlign(-1,-1).drawString(c,(A-a.stringWidth(c))/2,B/3);const d='Press radio to restart or power to exit';a.setColor(Z).setFontMonofonto16().setFontAlign(-1,-1).drawString(d,(A-a.stringWidth(d))/2,B/3+30),h&&(clearInterval(h),h=null);let b=!1;h=setInterval(()=>{Date.now()>=I&&BTN_PLAY.read()?b||(b=!0,clearInterval(h),h=null,a9()):b=!1},N)}function al(d){let a=Date.now();if(a-a4<a3)return;if(a4=a,d===0)X();else{b=(b+(d<0?1:-1)+R)%R;const a=b<k;const f=a?0:k;const e=a?m[b]:p[b-f];const g=a?i[b]:n[b-f];c>=e.embedAt&&c<e.embedAt+g.length&&(c=e.embedAt),j()}}function am(){const a=BTN_PLAY.read();const b=Date.now();a&&!a6&&b-a5>=a3&&(a5=b,J||X()),a6=a}function an(){L(),u&&clearInterval(u),bC.clear(1).flip(),E.reboot()}function ao(e){if(e===0){X();return}const d=b<k;const a=d?b:b-k;const o=d?m[a]:p[a];const q=d?i[a]:n[a];const f=o.line.length;const g=o.embedAt;let h=1;c>=g&&c<g+q.length&&(e>0?h=Math.max(1,g+q.length-c):h=Math.max(1,c-g));let l=c+(e>0?h:-h);if(e>0&&d&&l>=f){b=a+k,c=0,j();return}if(e<0&&!d&&l<0){b=a,c=m[a].line.length-1,j();return}c=(l%f+f)%f,j()}function ap(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function aq(){const a=[];if(i.forEach((c,f)=>{if(c===e)return;const b=m[f];if(!b||(typeof b.line)[1]!='t')return;const d=b.embedAt;if(d<0||d+c.length>b.line.length)return;/^\.+$/.test(b.line.substr(d,c.length))||a.push({side:'L',row:f,word:c})}),n.forEach((c,f)=>{if(c===e)return;const b=p[f];if(!b||(typeof b.line)[1]!='t')return;const d=b.embedAt;if(d<0||d+c.length>b.line.length)return;/^\.+$/.test(b.line.substr(d,c.length))||a.push({side:'R',row:f,word:c})}),a.length===0)return null;const b=a[Math.random()*a.length|0];const h=b.side==='L'?m:p;const c=h[b.row];const d=c.embedAt;const f=b.word.length;const g=c.line;return c.line=g.slice(0,d)+'.'.repeat(f)+g.slice(d+f),b}function L(){Pip.removeAllListeners(a0),Pip.removeAllListeners(a1),Pip.removeAllListeners(a2)}function a9(){h&&(clearInterval(h),h=null),u&&(clearInterval(u),u=null),J=!1,c=0,b=0,o=H,s=null,d=[],m=[],p=[],e=null,j.prevRow=undefined,j.prevCol=undefined,M.run()}function ar(c){let b;if(Math.random()<.5?(o=H,d.push('> TRIES RESET'),V(),W()):(b=aq(),d.push('> DUD REMOVED')),K(),b){const e=b.side==='L';const c=e?w:y;const d=b.row;const h=e?2404:2608;const i='0xF'+(h+d).toString(16).padStart(3,'0');const g=10;const f=c.y1+d*g;a.setColor(r).fillRect(c.x1,f,c.x2,f+g);const j=e?m[d].line:p[d].line;a.setColor(l).setFont('6x8').setFontAlign(-1,-1).drawString(i+' '+j,c.x1+2,f)}j(),t(w),t(y),z=z.filter(a=>a!==c)}function X(){const l=z.find(a=>a.row===b&&c>=a.startCol&&c<=a.endCol);if(l){ar(l);return}const h=b<k;const j=h?b:b-k;const a=h?m[j]:p[j];const u=h?i:n;const r=u[j];if(!a||(typeof a.line)[1]!='t'||(typeof a.embedAt)[0]!='n'){console.error('select(): invalid junk at row',b,a);return}const g=a.embedAt;const t=a.line;const f=t.slice(g,g+r.length);const v=/^\.+$/.test(f);const w=!v&&c>=g&&c<g+r.length;if(d.length===1&&d[0]==='> . '&&d.pop(),o<=0){a7();return}if(w){s=f;const a=d.findIndex(a=>a==='> '+s);if(a!==-1){const b=d[a+1];d.push('> '+s),b&&b.startsWith('>')&&d.push(b)}else{if(s===e){d.push('> '+s),d.push('> ACCESS GRANTED'),K(),ak();return}let a=0;if(f.length===e.length)for(let b=0;b<f.length;b++)f[b]===e[b]&&a++;const b=Math.floor((q.y2-q.y1)/10)-1;while(d.length>b)d.shift();d.push('> '+s),d.push(`> [${a}]`),o--,V(),W(),o===0&&d.push('> Entry denied')}}else{s=t[c];const a=Math.floor((q.y2-q.y1)/10);d.length>=a&&d.shift(),d.push('> ['+s+']')}K()}function as(b){for(var a=b.length-1;a>0;a--){var c=Math.random()*(a+1)|0,d=b[a];b[a]=b[c],b[c]=d}}function at(){Pip.on(a0,al),Pip.on(a1,ao),Pip.on(a2,ap)}function F(b,c){const a='{}[]<>?/\\|!@#$%^&*()-_=+;:"\',.`~';if(!c){let c='';for(let f=0;f<b;f++)c+=a[Math.random()*a.length|0];return{line:c,embedAt:b}}let d='';const e=Math.random()*(b-c.length)|0;for(let f=0;f<b;f++)f===e?(d+=c,f+=c.length-1):d+=a[Math.random()*a.length|0];return{line:d,embedAt}}function au(){const b=i.concat(n);e=b[Math.floor(Math.random()*b.length)];const a=i.includes(e)?'L':'R';const c=a==='L'?i.indexOf(e):n.indexOf(e);const d=.4;m=i.map((b,f)=>(a==='L'&&f===c?(F(12,e)):(Math.random())<d?(F(12,'')):(F(12,b)))),p=n.map((b,f)=>(a==='R'&&f===c?(F(12,e)):(Math.random())<d?(F(12,'')):(F(12,b))))}function aa(){const a=i.concat(n);e=a[Math.floor(Math.random()*a.length)],T=i.includes(e)?'L':'R',ag=T==='L'?i.indexOf(e):n.indexOf(e),Pip.removeAllListeners(_),aj(),W(),V(),au(),ah(),a8(i,w,2404,m),a8(n,y,2608,p),t(f),t(C),t(D),t(v),t(w),t(y),t(q),d=['> . '],K(),at(),h&&clearInterval(h),u&&clearInterval(u),u=setInterval(am,N)}const M={};const ab='Porta Hack';const ac='1.1.0';const Y=!1;const N=16.666666666666668;const H=4;let o=H;let e=null;let c=0;let b=0;let I=0;let J=!1;let m=[];let p=[];let s=null;let z=[];let u=null;let h=null;const x=8;const G='6x'+x;const a=g;const A=g.getWidth();const B=g.getHeight();const f={x1:60,x2:A-60,y1:10,y2:B-10};const O={height:x+4,padding:2,textHeight:x};const C={x1:f.x1,x2:f.x2,y1:f.y1,y2:f.y1+O.height};const P={height:x+4,padding:2,textHeight:x};const D={x1:f.x1,x2:f.x2,y1:C.y2,y2:C.y2+P.height};const Q={height:x*3+2+2,padding:2,textHeight:x};const v={x1:f.x1,x2:f.x2,y1:D.y2,y2:D.y2+Q.height};const w={x1:f.x1,x2:f.x1+(f.x2-f.x1)*.35,y1:v.y2,y2:f.y2};const y={x1:w.x2,x2:w.x2+(f.x2-f.x1)*.35,y1:v.y2,y2:f.y2};const q={x1:y.x2,x2:f.x2,y1:v.y2,y2:f.y2};let d=[];const r='#000000';const ad='#ffffff';const l='#00ff00';const Z='#007f00';const av='#003300';const _='videoStopped';const ae='USER/PORTAHACK/STARTHACK.avi';const af=['STORY','SYNOPSIS','THE','PLAYER','CHARACTER','PC','STUMBLES','ONTO','PLOT','BUILD','HYPERLIGHT','TRANSMITTER','THAT','WILL','BE','USED','COMMAND','FORGOTTEN','ORBITAL','WEAPONS','PLATFORM','MYSTERIOUS','WASTELORD','WITH','MESSIANIC','COMPLEX','KNOWN','AS','PUPPETMASTER','FOR','HIS','ABILITY','CONTROL','MINDS','OF','DANGEROUS','MONSTERS','HAS','SENT','ARMIES','SCOUR','WASTES','PIECES','TECHNOLOGY','IN','ORDER','BUILDER','ABLE','HARNESS','AWESOME','DESTRUCTIVE','POWER','AND','BECOME','ABSOLUTE','RULER','IS','TOSSED','INTO','MIDDLE','CONFLICT','WHEN','RAIDERS','KIDNAP','ENSLAVE','KINDLY','VILLAGERS','WHO','HAVE','SAVED','LIFE','AT','START','GAME','STRUGGLES','FIND','FREE','HE','UNCOVERS','MUST','ACT','STOP','DISCOVER','WAY','THWART','PLANS','BY','UNLOCKING','SECRET','ANDROID','CITIZENS','MAYVILLE','AI','CONTROLS','THEM','HIDDEN','DEEP','BENEATH','CORE','OFFERS','HELP','BEFORE','CAN','COMPLETE','FORGES','AN','UNLIKELY','ALLIANCE','BETWEEN','CITY','MUTANTS','GROUP','SCIENTISTS','SURVIVORS','FROM','BASE','RACE','AGAINST','FORCES','PARTS'];const k=25;const R=k*2;const S=af.slice();as(S);const i=S.slice(0,k);const n=S.slice(k,R);const $=i.concat(n);e=$[Math.floor(Math.random()*$.length)];const T=i.includes(e)?'L':'R';const ag=T==='L'?i.indexOf(e):n.indexOf(e);const a0='knob1';const a1='knob2';const a2='torch';const a3=100;let a4=0;let a5=0;let a6=!1;return M.run=function(){if(!(a&&bC))throw new Error('Pip-Boy graphics not available!');bC.clear(),U(),L(),setWatch(()=>an(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0}),Y?aa():(Pip.videoStart(ae,{x:40}),Pip.on(_,aa))},M}PortaHack().run()