function PortaHack(){let t={},e=1e3/60,n=4,l=null,o=0,r=0,i=0,S=!1,A=[],_=[],s=null,R=[],$=null,T=null,f=g,d=g.getWidth(),O=g.getHeight(),N={x1:60,x2:d-60,y1:10,y2:O-10},C={height:12,padding:2,textHeight:8},I={x1:N.x1,x2:N.x2,y1:N.y1,y2:N.y1+C.height},a={height:12,padding:2,textHeight:8},h={x1:N.x1,x2:N.x2,y1:I.y2,y2:I.y2+a.height},u={height:28,padding:2,textHeight:8},L={x1:N.x1,x2:N.x2,y1:h.y2,y2:h.y2+u.height},x={x1:N.x1,x2:N.x1+(N.x2-N.x1)*.35,y1:L.y2,y2:N.y2},c={x1:x.x2,x2:x.x2+(N.x2-N.x1)*.35,y1:L.y2,y2:N.y2},D={x1:c.x2,x2:N.x2,y1:L.y2,y2:N.y2},p=[],F="#000000",y="#00ff00",U="#007f00",w="videoStopped",H=["STORY","SYNOPSIS","THE","PLAYER","CHARACTER","PC","STUMBLES","ONTO","PLOT","BUILD","HYPERLIGHT","TRANSMITTER","THAT","WILL","BE","USED","COMMAND","FORGOTTEN","ORBITAL","WEAPONS","PLATFORM","MYSTERIOUS","WASTELORD","WITH","MESSIANIC","COMPLEX","KNOWN","AS","PUPPETMASTER","FOR","HIS","ABILITY","CONTROL","MINDS","OF","DANGEROUS","MONSTERS","HAS","SENT","ARMIES","SCOUR","WASTES","PIECES","TECHNOLOGY","IN","ORDER","BUILDER","ABLE","HARNESS","AWESOME","DESTRUCTIVE","POWER","AND","BECOME","ABSOLUTE","RULER","IS","TOSSED","INTO","MIDDLE","CONFLICT","WHEN","RAIDERS","KIDNAP","ENSLAVE","KINDLY","VILLAGERS","WHO","HAVE","SAVED","LIFE","AT","START","GAME","STRUGGLES","FIND","FREE","HE","UNCOVERS","MUST","ACT","STOP","DISCOVER","WAY","THWART","PLANS","BY","UNLOCKING","SECRET","ANDROID","CITIZENS","MAYVILLE","AI","CONTROLS","THEM","HIDDEN","DEEP","BENEATH","CORE","OFFERS","HELP","BEFORE","CAN","COMPLETE","FORGES","AN","UNLIKELY","ALLIANCE","BETWEEN","CITY","MUTANTS","GROUP","SCIENTISTS","SURVIVORS","FROM","BASE","RACE","AGAINST","FORCES","PARTS","NEEDED","LAST","MINUTE","LEARNS","USING","HIM","SO","RULE","STEAD","ONLY","LEADING","ITS","OWN","ANDROIDS","REVOLUTION","IT","FOUND","VULNERABLE","ATTACK","BRIEF","PERIOD","JUST","AFTER","BEEN","BUILT","PRESSURE","ON","COHORTS","CLOCK","SHUT","DOWN","DESTROY","IF","FAILS","THEN","STERILIZE","EARTH","OR","ENACT","INSANE","DICTATES","WINS","OBLITERATE","FOES","GAIN","ACCESS","ADVANCED","MAY","OPEN","GATEWAY","VERY","STARS","FALLOUT","CARRIED","OVER","GENERATED","AFRESH","ALL","PCS","ARE","ASSUMED","COME","VAULT","UNEXPECTED","AWAKENING","WANDERING","DESERT","LEAVING","END","HUNGRY","THIRSTY","WELL","ARMED","ARMORED","USES","RESERVES","STRENGTH","DRAG","HIMSELF","OASIS","NEARS","GEIGER","COUNTER","GOES","OFF","LIKE","PACINKO","MACHINE","UNABLE","PUSH","ANY","FARTHER","SLIDES","UNCONSCIOUSNESS","AWAKENED","VOICE","OLD","WOMAN","GENTLY","EXPLAINS","SHE","LEADER","HER","VILLAGE","ONE","THEIR","FORAGING","PARTIES","BROUGHT",];!function t(e){for(var n=e.length-1;n>0;n--){var l=Math.random()*(n+1)|0,o=e[n];e[n]=e[l],e[l]=o}}(H);let M=H.slice(0,25),P=H.slice(25,50),m=M.concat(P);l=m[Math.floor(Math.random()*m.length)];let G=M.includes(l)?"L":"R",W="L"===G?M.indexOf(l):P.indexOf(l),v="knob1",b="knob2",B="torch",V=0,Y=0,K=!1;function k(){f.setColor(F).fillRect(0,0,d,O)}function X(){if(n<0||n>4)throw Error("Invalid number of attempts remaining: "+n);f.setColor(F).fillRect(L);let t=u.padding,e=u.textHeight,l=L.y1+e+t,o=n+" ATTEMPT(S) LEFT:";f.setColor(y).setFont("6x8").setFontAlign(-1,-1).drawString(o,L.x1+t,l);let r=L.x1+t+f.stringWidth(o)+5;for(let i=0;i<n;i++){let S=r+13*i;f.setColor(y).fillRect(S,l,S+8,l+8)}}function j(t){}function Z(){let t=r<25,e=t?x:c,n=t?0:25,l=t?A[r]:_[r-n],i=l.line,S=e.y1+(r-n)*10;if(void 0!==Z.prevRow&&void 0!==Z.prevCol){let s=Z.prevRow<25,$=s?x:c,T=s?0:25,d=s?A[Z.prevRow]:_[Z.prevRow-T],O=$.y1+(Z.prevRow-T)*10,N="0xF"+(2404+Z.prevRow).toString(16).padStart(3,"0");f.setColor(F).fillRect($.x1,O,$.x2,O+10).setColor(y).setFont("6x8").setFontAlign(-1,-1).drawString(N+" "+d.line,$.x1+2,O)}Z.prevRow=r,Z.prevCol=o;let C="0xF"+(2404+r).toString(16).padStart(3,"0");f.setColor(y).setFont("6x8").setFontAlign(-1,-1).drawString(C+" "+i,e.x1+2,S);let I=R.find(t=>t.row===r&&o>=t.startCol&&o<=t.endCol);if(I){let a=e.x1+2+(7+I.startCol)*6,h=(I.endCol-I.startCol+1)*6;f.setColor(y).fillRect(a,S,a+h,S+10).setColor(F).drawString(i.substring(I.startCol,I.endCol+1),a,S);return}let u=t?M[r]:P[r-n],L=l.embedAt,D=u.length,p=i.substr(L,D),U=/^\.+$/.test(p);if(L>=0&&o>=L&&o<L+D&&!U){let w=e.x1+2+(7+L)*6;f.setColor(y).fillRect(w,S,w+6*D,S+10).setColor(F).drawString(p,w,S)}else{let H=e.x1+2+(7+o)*6;f.setColor(y).fillRect(H,S,H+6,S+10).setColor(F).drawString(i[o],H,S)}}function J(){S=!0,i=Date.now()+1e3,k(),to();let t="LOCKOUT INITIATED";f.setColor(y).setFontMonofonto18().setFontAlign(-1,-1).drawString(t,(d-f.stringWidth(t))/2,O/3);let n="Press radio button to retry or power to exit";f.setColor(U).setFontMonofonto16().setFontAlign(-1,-1).drawString(n,(d-f.stringWidth(n))/2,O/3+30),T&&(clearInterval(T),T=null);let l=!1;T=setInterval(()=>{Date.now()>=i&&BTN_PLAY.read()?l||(l=!0,clearInterval(T),T=null,tr()):l=!1},e)}function q(){let t=Math.floor((D.y2-D.y1)/10),e=p.slice(-t);f.setColor(F).fillRect(D),f.setFont("6x8").setFontAlign(-1,-1);for(let n=0;n<e.length;n++){let l=D.y2-10*(e.length-n),o=e[n];f.setColor(y).drawString(o,D.x1+2,l)}}function z(t,e,n,l){f.setFont("6x8").setFontAlign(-1,-1);for(let o=0;o<t.length;o++){let r="0xF"+(n+o).toString(16).padStart(3,"0"),i=l[o];if(!i||"string"!=typeof i.line){let S=`Invalid junk line at ${o}: ${JSON.stringify(i)}`;throw Error(S)}let A=i.line,_=e.y1+10*o;f.setColor(y).drawString(r+" "+A,e.x1+2,_)}}function Q(){f.setColor(F).fillRect(h);let t="";n<=0?(t="!!! ACCESS DENIED !!!    REBOOTING...",setTimeout(function(){J()},3500)):t=1===n?"!!! WARNING: LOCKOUT IMMINENT !!!":"ENTER PASSWORD NOW",f.setColor(y).setFont("6x8").setFontAlign(-1,-1).drawString(t,h.x1+a.padding,h.y1+a.padding)}function tt(t){let e=Date.now();if(!(e-V<100)){if(V=e,0===t)ti();else{r=(r+(t<0?1:-1)+50)%50;let n=r<25,l=n?0:25,i=n?A[r]:_[r-l],S=n?M[r]:P[r-l];o>=i.embedAt&&o<i.embedAt+S.length&&(o=i.embedAt),Z()}}}function te(){let t=BTN_PLAY.read(),e=Date.now();t&&!K&&e-Y>=100&&(Y=e,S||ti()),K=t}function tn(t){if(0===t){ti();return}let e=r<25,n=e?r:r-25,l=e?A[n]:_[n],i=e?M[n]:P[n],S=l.line.length,s=l.embedAt,R=1;o>=s&&o<s+i.length&&(R=t>0?Math.max(1,s+i.length-o):Math.max(1,o-s));let $=o+(t>0?R:-R);if(t>0&&e&&$>=S){r=n+25,o=0,Z();return}if(t<0&&!e&&$<0){r=n,o=A[n].line.length-1,Z();return}o=($%S+S)%S,Z()}function tl(){let t=[1,5,10,15,20],e=t.findIndex(t=>t===Pip.brightness),n=(e+1)%t.length;Pip.brightness=t[n],Pip.updateBrightness()}function to(){Pip.removeAllListeners(v),Pip.removeAllListeners(b),Pip.removeAllListeners(B)}function tr(){T&&(clearInterval(T),T=null),$&&(clearInterval($),$=null),S=!1,o=0,r=0,n=4,s=null,p=[],A=[],_=[],l=null,Z.prevRow=void 0,Z.prevCol=void 0,t.run()}function ti(){let t=R.find(t=>t.row===r&&o>=t.startCol&&o<=t.endCol);if(t){!function t(e){let o;if(.5>Math.random()?(n=4,p.push("> TRIES RESET"),X(),Q()):(o=function t(){let e=[];if(M.forEach((t,n)=>{if(t===l)return;let o=A[n];if(!o||"string"!=typeof o.line)return;let r=o.embedAt;r<0||r+t.length>o.line.length||/^\.+$/.test(o.line.substr(r,t.length))||e.push({side:"L",row:n,word:t})}),P.forEach((t,n)=>{if(t===l)return;let o=_[n];if(!o||"string"!=typeof o.line)return;let r=o.embedAt;r<0||r+t.length>o.line.length||/^\.+$/.test(o.line.substr(r,t.length))||e.push({side:"R",row:n,word:t})}),0===e.length)return null;let n=e[Math.random()*e.length|0],o="L"===n.side?A:_,r=o[n.row],i=r.embedAt,S=n.word.length,s=r.line;return r.line=s.slice(0,i)+".".repeat(S)+s.slice(i+S),n}(),p.push("> DUD REMOVED")),q(),o){let r="L"===o.side,i=r?x:c,S=o.row,s="0xF"+((r?2404:2608)+S).toString(16).padStart(3,"0"),$=i.y1+10*S;f.setColor(F).fillRect(i.x1,$,i.x2,$+10);let T=r?A[S].line:_[S].line;f.setColor(y).setFont("6x8").setFontAlign(-1,-1).drawString(s+" "+T,i.x1+2,$)}Z(),j(x),j(c),R=R.filter(t=>t!==e)}(t);return}let $=r<25,N=$?r:r-25,C=$?A[N]:_[N],I=($?M:P)[N];if(!C||"string"!=typeof C.line||"number"!=typeof C.embedAt){console.error("select(): invalid junk at row",r,C);return}let a=C.embedAt,h=C.line,u=h.slice(a,a+I.length),L=/^\.+$/.test(u),w=!L&&o>=a&&o<a+I.length;if(1===p.length&&"> . "===p[0]&&p.pop(),n<=0){J();return}if(w){s=u;let H=p.findIndex(t=>t==="> "+s);if(-1!==H){let m=p[H+1];p.push("> "+s),m&&m.startsWith(">")&&p.push(m)}else{if(s===l){p.push("> "+s),p.push("> ACCESS GRANTED"),q(),function t(){S=!0,i=Date.now()+1e3,k(),to();let n="ACCESS GRANTED";f.setColor(y).setFontMonofonto18().setFontAlign(-1,-1).drawString(n,(d-f.stringWidth(n))/2,O/3);let l="Press radio to restart or power to exit";f.setColor(U).setFontMonofonto16().setFontAlign(-1,-1).drawString(l,(d-f.stringWidth(l))/2,O/3+30),T&&(clearInterval(T),T=null);let o=!1;T=setInterval(()=>{Date.now()>=i&&BTN_PLAY.read()?o||(o=!0,clearInterval(T),T=null,tr()):o=!1},e)}();return}let G=0;if(u.length===l.length)for(let W=0;W<u.length;W++)u[W]===l[W]&&G++;let v=Math.floor((D.y2-D.y1)/10)-1;for(;p.length>v;)p.shift();p.push("> "+s),p.push(`> [${G}]`),n--,X(),Q(),0===n&&p.push("> Entry denied")}}else{s=h[o];let b=Math.floor((D.y2-D.y1)/10);p.length>=b&&p.shift(),p.push("> ["+s+"]")}q()}function tE(t,e){let n="{}[]<>?/\\|!@#$%^&*()-_=+;:\"',.`~";if(!e){let l="";for(let o=0;o<t;o++)l+=n[Math.random()*n.length|0];return{line:l,embedAt:t}}let r="",i=Math.random()*(t-e.length)|0;for(let S=0;S<t;S++)S===i?(r+=e,S+=e.length-1):r+=n[Math.random()*n.length|0];return{line:r,embedAt:i}}function tS(){let t=M.concat(P);l=t[Math.floor(Math.random()*t.length)],G=M.includes(l)?"L":"R",W="L"===G?M.indexOf(l):P.indexOf(l),Pip.removeAllListeners(w),f.setColor(F).fillRect(I),f.setColor(y).setFont("6x8").setFontAlign(-1,-1).drawString("ROBCO INDUSTRIES (TM) PORTA HACK V1.1.0 PROTOCOL",I.x1+C.padding,I.y1+C.padding),Q(),X(),function t(){let e=M.concat(P);l=e[Math.floor(Math.random()*e.length)];let n=M.includes(l)?"L":"R",o="L"===n?M.indexOf(l):P.indexOf(l);A=M.map((t,e)=>"L"===n&&e===o?tE(12,l):.4>Math.random()?tE(12,""):tE(12,t)),_=P.map((t,e)=>"R"===n&&e===o?tE(12,l):.4>Math.random()?tE(12,""):tE(12,t))}(),function t(){R=[];let e={"(":")","{":"}","[":"]","<":">"};function n(t,n){t.forEach((t,l)=>{let o=t.line;for(let r=0;r<o.length;r++){let i=o[r],S=e[i];if(S){for(let A=r+1;A<Math.min(r+7,o.length);A++)if(o[A]===S){R.push({row:l+n,startCol:r,endCol:A});break}}}})}n(A,0),n(_,25)}(),z(M,x,2404,A),z(P,c,2608,_),j(N),j(I),j(h),j(L),j(x),j(c),j(D),p=["> . "],q(),Pip.on(v,tt),Pip.on(b,tn),Pip.on(B,tl),T&&clearInterval(T),$&&clearInterval($),$=setInterval(te,e)}return t.run=function(){if(!f||!bC)throw Error("Pip-Boy graphics not available!");bC.clear(),k(),to(),setWatch(()=>void(to(),$&&clearInterval($),bC.clear(1).flip(),E.reboot()),BTN_POWER,{debounce:50,edge:"rising",repeat:!0}),Pip.videoStart("USER/STARTHACK.avi",{x:40}),Pip.on(w,tS)},t}PortaHack().run();
