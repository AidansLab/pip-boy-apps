function CustomRadio(){function L(){t&&clearInterval(t),t=null}function x(){g.setColor(J).fillRect(l)}function Z(){n&&clearInterval(n),n=null,j=null,e&&(e=null,E.defrag())}function r(){if(U===!1)return;s(a),s(b),s(l),s(V),s(o),N()}function _(){const d=Q.toUpperCase();const e='v'+R;const c=5;const f=g.stringWidth(d);g.setColor(k).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(d,b.x1,a.y1+8),g.setColor(u).setFontAlign(-1,-1,0).setFont('6x8').drawString(e,b.x1+f+c,a.y1+16),g.setColor(K).drawLine(b.x1,b.y1-c,b.x2,b.y1-c)}function s(a){g.setColor(K).drawRect(a.x1,a.y1,a.x2,a.y2)}function $(){L(),t=setInterval(()=>{drawFooter()},Y)}function a0(b){if(!b)throw new Error('No song provided to drawNowPlaying');const a=b.replace(/\.wav$/i,'');const c=a.length>19?a.slice(0,16)+'...':a;g.setColor(k).setFontAlign(1,-1,0).setFontMonofonto16().drawString(c,l.x2,l.y1+20)}function a1(){g.setColor(u).setFontAlign(1,1,0).setFont('6x8').drawString('Now Playing',l.x2,l.y1+15)}function M(){const a=f*i;const h=c.slice(a,a+i);g.setColor(J).fillRect(b),g.setFontMonofonto16().setFontAlign(-1,-1,0);const e=5;const j=20;h.forEach((i,c)=>{const f=b.y1+c*j+e;const a=i.replace(/\.wav$/i,'');const h=a.length>19?a.slice(0,16)+'...':a;g.setColor(c===d?k:u).drawString(h,b.x1+e,f,!0)}),r()}function N(){const d=5;const h=3;const e=o.x1;const c=o.y1;const b=o.x2;const i=o.y2;const a=i-1;const f=b;for(let j=0;j<40;j++){const l=j%d===0?k:u;const b=j%d===0?2:1;const i=e+j*h;const m=a-b;g.setColor(l),g.drawLine(i,m,i,a),g.drawLine(f-b,c+j*3,f,c+j*3)}g.setColor(k),g.drawLine(e,a,b,a),g.drawLine(b,a,b,c)}function a2(){w=0,e=Graphics.createArrayBuffer(120,120,2,{msb:!0}),E.getAddressOf(e,0)===0&&(e=undefined,E.defrag(),e=Graphics.createArrayBuffer(120,120,2,{msb:!0})),j=new Uint16Array(60);for(let a=0;a<60;a+=2)j[a]=a*2;n&&clearInterval(n),n=setInterval(()=>{if(!e)return;if(e.clearRect(0,0,119,119),Pip.radioClipPlaying)Pip.getAudioWaveform(j,20,100);else if(Pip.radioOn&&(typeof RADIO_AUDIO)[0]!='u')for(let a=1;a<60;a+=2)j[a]=E.clip(60+(analogRead(RADIO_AUDIO)-.263)*600,0,119);else{let a=w;for(let b=1;b<60;b+=2)j[b]=60+Math.sin(a)*45*Math.sin((a+=.6)*.13)}e.drawPolyAA(j),w+=.3,Pip.blitImage(e,285,75,{noScanEffect:!0})},X)}function a3(e){let b=Date.now();if(b-G<W)return;if(G=b,e!==0)return O(e*-1);const g=f*i;const a=c[g+d];if(!a)return;const j='/'+I+a;a==='RANDOM'?m?(m=!1,v()):h!==null?(m=!0,nextSongToPlay='RANDOM',v()):(m=!0,p=c.slice(1).sort(()=>Math.random()-.5),q=0,y()):h===j?(nextSongToPlay=null,v()):(m=!1,nextSongToPlay=a,h!==null?v():(z(nextSongToPlay),nextSongToPlay=null))}function a4(){L(),Z(),P(),settings.idleTimeout=B,bC.clear(1).flip(),E.reboot()}function a5(a){O(a)}function a6(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function a7(){if(m)y();else if(nextSongToPlay){const a=nextSongToPlay;nextSongToPlay=null,a==='RANDOM'?(p=c.slice(1).sort(()=>Math.random()-.5),q=0,y()):z(a)}else h=null,Pip.radioClipPlaying=!1,x(),r()}function a8(){try{c=fs.readdir('/RADIO').filter(a=>a.endsWith('.wav')).sort(),print('Loaded '+c.length+' songs:'),c.unshift('RANDOM')}catch(a){print('Failed to load songs:',a),c=[]}f=0,d=0,M()}function O(g){const a=f*i;const b=c.slice(a,a+i);const e=Math.floor((c.length-1)/ i);d+=g,d<0?f>0?(f--,d=i-1):d=0:d>=b.length&&(f<e?(f++,d=0):d=b.length-1),M()}function y(){q>=p.length&&(p=c.slice(1).sort(()=>Math.random()-.5),q=0),z(p[q++])}function z(a){h='/'+I+a,Pip.audioStart(h),Pip.radioClipPlaying=!0,x(),a1(),a0(a),r()}function P(){Pip.removeAllListeners(C),Pip.removeAllListeners(D),Pip.removeAllListeners(F),Pip.removeAllListeners(H)}function a9(){Pip.on(C,a3),Pip.on(D,a5),Pip.on(F,a6),Pip.on(H,a7),setWatch(()=>a4(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0})}function v(){Pip.audioStop(),h=null,Pip.radioClipPlaying=!1,x(),r()}const A={};const Q='Custom Radio';const R='3.2.0';const S=g.getWidth();const T=g.getHeight();const U=!1;let B=settings.idleTimeout;const a={x1:60,y1:40,x2:S-60,y2:T-20};const b={x1:a.x1+10,y1:a.y1+30,x2:(a.x2+a.x1)/2,y2:a.y2-20};const V={x1:b.x2+10,y1:a.y1+30,x2:a.x2-10,y2:a.y2-20};const l={x1:b.x2+10,y1:a.y2-100,x2:a.x2-10,y2:a.y2-60};const o={x1:b.x2+45,y1:a.y1+37,x2:a.x2-12,y2:a.y2-101};const C='knob1';const D='knob2';const F='torch';const W=10;let G=0;const H='audioStopped';const I='RADIO/';let h=null;const i=10;let f=0;let d=0;let c=[];let m=!1;let p=[];let q=0;const X=50;let w=0;let e=null;let n=null;let j=null;const Y=49.99923706054;let t=null;const J='#000000';const k=g.theme.fg;const u=g.blendColor('#000',k,.5);const K=g.blendColor('#000',k,.75);return A.run=function(){B=settings.idleTimeout,settings.idleTimeout=0,bC.clear(1).flip(),Pip.mode=MODE.RADIO,drawHeader(Pip.mode),P(),a9(),a8(),a2(),N(),_(),$(),r()},A}CustomRadio().run()