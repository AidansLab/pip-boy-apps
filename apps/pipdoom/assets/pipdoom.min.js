function PipDoom(){function U(e,g){let b=a.x,d=a.y;for(let a=0;a<n;a++){b+=e*f,d+=g*f;const i=b/c|0;const h=d/c|0;if(p[h]&&p[h][i]===1)return(a+1)*f}return n*f}function j(){const b=q[a.angleIdx];const i=r[a.angleIdx];for(let a=0;a<e;a++){const e=K+a*m;const k=e+m-1;const q=U(b[a],i[a]);let j=z*c/q;j>d&&(j=d);const p=l+z-(j>>1);const r=p+j;const s=Math.min(o.length-1,Math.floor(q/(n*f/o.length)));g.setColor(h).fillRect(e,l,k,p-1),g.setColor(o[s]).fillRect(e,p,k,r),g.setColor(h).fillRect(e,r+1,k,l+d)}V()}function V(){const a=T[u];const b=2.5;const e=a.width*b;const f=a.height*b;const c=w-e>>1;const d=x-f-4+(k?3:0);g.setColor(h).fillRect(c,d,c+e,d+f),g.setColor(i),g.drawImage(a,c,d,{scale:b})}function H(c){if(c!==0){if(s)return;s=!0,a.angleIdx=(a.angleIdx+c+b)%b,Pip.audioStart(P),j(),setTimeout(()=>s=!1,120)}else X()}function I(a){try{let c=fs.readFile(a);let b=JSON.parse(c);return{bpp:b.bpp,buffer:atob(b.buffer),height:b.height,transparent:b.transparent,width:b.width}}catch(b){return console.log(a,b),null}}function W(e){const b=a.x+D[a.angleIdx]*B*e;const d=a.y+C[a.angleIdx]*B*e;const f=d/c|0;const g=b/c|0;p[f][g]?(Pip.audioStop(),Pip.audioStart(S)):(a.x=b,a.y=d),j()}function J(){Pip.removeAllListeners(F),Pip.removeAllListeners(G)}function X(){if(k)return;Pip.audioStop(),Pip.audioStart('USER/PIP_DOOM/SHOOT.wav'),k=!0,u=1,j(),setTimeout(()=>{u=0,k=!1,j()},60)}const v={};const w=g.getWidth();const x=g.getHeight();const y=256,d=192;const K=w-y>>1;const l=x-d>>1;const z=d>>1;const m=32;const e=y/m|0;const A=Math.PI/3;const b=16;const c=64;const f=4;const n=64;const B=12;const h='#000000';const i=g.theme.fg||'#00FF00';const L=g.blendColor(i,'#FFFFFF',.3);const M=g.blendColor(h,i,.5);const N=g.blendColor(h,i,.75);const o=[L,i,M,N];let a={x:2.5*c,y:2.5*c,angleIdx:0};const p=[[1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1]];const C=new Float32Array(b);const D=new Float32Array(b);for(let g=0;g<b;g++){const a=g/b*2*Math.PI;C[g]=Math.sin(a),D[g]=Math.cos(a)}const q=Array(b);const r=Array(b);for(let g=0;g<b;g++){const a=g/b*2*Math.PI;q[g]=new Float32Array(e),r[g]=new Float32Array(e);for(let E=0;E<e;E++){const b=a-A/2+E/e*A;q[g][E]=Math.cos(b),r[g][E]=Math.sin(b)}}const F='knob1';const G='knob2';let s=!1;let t;let k=!1;let u=0;const O='USER/PIP_DOOM/F_STEP_1.wav';const P='USER/PIP_DOOM/F_STEP_2.wav';const Q='USER/PIP_DOOM/PISTOL_0.json';const R='USER/PIP_DOOM/PISTOL_1.json';const S='USER/PIP_DOOM/OOF.wav';const T=[I(Q),I(R)];return v.run=function(){j(),J(),Pip.on(F,H),Pip.on(G,H),t=setInterval(()=>{BTN_PLAY.read()&&(Pip.audioStart(O),W(1))},120),setWatch(()=>{t&&(clearInterval(t),t=null),J(),E.reboot()},BTN_POWER,{debounce:50,edge:'rising',repeat:!0})},v}PipDoom().run()