function PipDoom(){function a1(e,f){let b=a.x,d=a.y;for(let a=0;a<t;a++){b+=e*i,d+=f*i;const h=b/c|0;const g=d/c|0;if(x[g]&&x[g][h]===1)return(a+1)*i}return t*i}function q(){const a=80;const c=10;const b=l-j-c;g.setColor(d),g.fillRect(a-2,b-2,a+m*(j+M)+2,l);for(let f=0;f<m;f++){const c=a+f*(j+M);g.setColor(f<n?e:d),g.fillRect(c,b,c+j,b+j)}}function k(){const b=y[a.angleIdx];const e=z[a.angleIdx];for(let a=0;a<h;a++){const h=Q+a*s;const k=h+s-1;const m=a1(b[a],e[a]);let j=F*c/m;j>f&&(j=f);const l=r+F-(j>>1);const n=l+j;const o=Math.min(u.length-1,Math.floor(m/(t*i/u.length)));g.setColor(d).fillRect(h,r,k,l-1),g.setColor(u[o]).fillRect(h,l,k,n),g.setColor(d).fillRect(h,n+1,k,r+f)}a2(),q()}function a2(){const a=$[A];const b=2.5;const h=a.width*b;const i=a.height*b;const c=C-h>>1;const f=l-i-4+(p?3:0);g.setColor(d).fillRect(c,f,c+h,f+i),g.setColor(e),g.drawImage(a,c,f,{scale:b})}function N(c){if(c!==0){if(v)return;v=!0,a.angleIdx=(a.angleIdx+c+b)%b,Pip.audioStart(S),k(),setTimeout(()=>v=!1,120)}else a5()}function O(a){try{let c=fs.readFile(a);let b=JSON.parse(c);return{bpp:b.bpp,buffer:atob(b.buffer),height:b.height,transparent:b.transparent,width:b.width}}catch(b){return console.log(a,b),null}}function a3(e){const b=a.x+J[a.angleIdx]*H*e;const d=a.y+I[a.angleIdx]*H*e;const f=d/c|0;const g=b/c|0;x[f][g]?(Pip.audioStop(),Pip.audioStart(W)):(a.x=b,a.y=d),k()}function a4(){if(o)return;o=!0,Pip.audioStop(),Pip.audioStart(V),q(),setTimeout(()=>{n=m,o=!1,q()},_)}function P(){Pip.removeAllListeners(K),Pip.removeAllListeners(L)}function a5(){if(p||o)return;if(n<=0){a4();return}n--,q(),Pip.audioStop(),Pip.audioStart('USER/PIP_DOOM/SHOOT.wav'),p=!0,A=1,k(),setTimeout(()=>{A=0,p=!1,k()},a0)}const B={};const C=g.getWidth();const l=g.getHeight();const D=256,f=192;const Q=C-D>>1;const r=l-f>>1;const F=f>>1;const s=32;const h=D/s|0;const R='USER/PIP_DOOM/F_STEP_1.wav';const S='USER/PIP_DOOM/F_STEP_2.wav';const T='USER/PIP_DOOM/PISTOL_0.json';const U='USER/PIP_DOOM/PISTOL_1.json';const V='USER/PIP_DOOM/RELOAD.wav';const W='USER/PIP_DOOM/OOF.wav';const G=Math.PI/3;const b=16;const c=64;const i=4;const t=64;const H=12;const d='#000000';const e=g.theme.fg||'#00FF00';const X=g.blendColor(e,'#FFFFFF',.3);const Y=g.blendColor(d,e,.5);const Z=g.blendColor(d,e,.75);const u=[X,e,Y,Z];let a={x:2.5*c,y:2.5*c,angleIdx:0};let v=!1;let w;const x=[[1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,1],[1,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1]];const I=new Float32Array(b);const J=new Float32Array(b);for(let g=0;g<b;g++){const a=g/b*2*Math.PI;I[g]=Math.sin(a),J[g]=Math.cos(a)}const y=Array(b);const z=Array(b);for(let g=0;g<b;g++){const a=g/b*2*Math.PI;y[g]=new Float32Array(h),z[g]=new Float32Array(h);for(let E=0;E<h;E++){const b=a-G/2+E/h*G;y[g][E]=Math.cos(b),z[g][E]=Math.sin(b)}}const K='knob1';const L='knob2';const M=2;const _=2378;const j=8;const m=12;const $=[O(T),O(U)];const a0=60;let n=m;let A=0;let o=!1;let p=!1;return B.run=function(){k(),P(),Pip.on(K,N),Pip.on(L,N),w=setInterval(()=>{BTN_PLAY.read()&&(Pip.audioStart(R),a3(1))},120),setWatch(()=>{w&&(clearInterval(w),w=null),P(),E.reboot()},BTN_POWER,{debounce:50,edge:'rising',repeat:!0})},B}PipDoom().run()