function MTGTracker(){function a9(a,b,c){this.index=a,this.name=b,this.currentLife=c,this.commanderDamageSources=[]}function aa(a,b){this.index=a,this.fromSource=b,this.amount=0}function o(b,c,d){const a=parseInt(b);return Math.min(Math.max(a,c),d)}function W(){B&&clearInterval(B),B=null}function t(a){g.setColor(F).fillRect(a)}function ab(){W(),B=setInterval(()=>{drawFooter()},a7)}function f(a){g.setColor(a8).drawRect(a.x1,a.y1,a.x2,a.y2)}function G(){if(a5===!1)return;f(d),f(r),f(l)}function X(){switch(i){case 1:f(d);break;case 2:f(j);f(n);break;case 3:f(s);f(w);f(n);break;case 4:f(s);f(w);f(P);f(Q);break}}function ac(){const a=M.toUpperCase();const b='v'+Z;const c=70;const d=g.stringWidth(a);g.setColor(m).setFontAlign(-1,-1,0).setFontMonofonto23().drawString(a,A.x1,A.y1),g.setColor(x).setFontAlign(-1,-1,0).setFont('4x6',2).drawString(b,A.x1+d+c,A.y1+14)}function H(b){t(r);const a=5;g.setColor(m).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(b.toUpperCase(),r.x1,r.y1+a)}function p(e){t(l),g.setFontMonofonto16().setFontAlign(-1,-1,0);const c=5;const d=20;e.forEach((e,h)=>{const j=l.y1+h*d+c;let f=e;a==='gameNew'&&h===0&&b===0?f=`Player Count: < ${i} >`:a==='gameNew'&&h===0?f=`Player Count: ${i}`:a==='commanderDamage'&&e.index===b?f=` ${e.fromSource}: < ${e.amount} >`:a==='commanderDamage'&&(f=` ${e.fromSource}: ${e.amount}`),g.setColor(h===b?m:x).drawString(f,l.x1+c,j,!0)}),G()}function ad(){b=0,H('Help'),t(l),g.setFontMonofonto16().setFontAlign(-1,-1,0);const a=5;const c=20;const d=_.split('\n');d.forEach((d,e)=>{const b=l.y1+e*c+a;g.setColor(x).drawString(d,l.x1+a,b,!0)});const e=l.y2-c-a;g.setColor(m).drawString('Back',l.x1+a,e,!0),G()}function q(a,c){b=0,H(c),p(a)}function k(a,b){t(a),i===1?g.setFontMonofonto28().setFontAlign(0,-1,0):g.setFontMonofonto23().setFontAlign(0,-1,0);const c=10;const d=24;const h=(a.x1+a.x2)/2;const j=a.y1+c;g.setColor(e===b.index?m:x).drawString(b.name,h,j,!0);let f=b.currentLife;e===b.index&&(f=`< ${b.currentLife} >`);const k=(a.x1+a.x2)/2;const l=(a.y1+a.y2)/2-d/2+c;if(g.setColor(e===b.index?m:x).drawString(f,k,l,!0),v==='commander'&&e===b.index){const f='* -> EDH dmg';const h=5+a.x1;let c=a.y2-d+5;i===1&&(c+=-10),g.setColor(e===b.index?m:x).setFontAlign(-1,-1,0).setFont('6x8',2).drawString(f,h,c,!0)}X()}function z(){t(d),g.setFontMonofonto16().setFontAlign(-1,-1,0);switch(i){case 1:k(d,c[0]);break;case 2:k(j,c[1]);k(n,c[0]);break;case 3:k(s,c[1]);k(w,c[2]);k(n,c[0]);break;case 4:k(s,c[1]);k(w,c[2]);k(P,c[0]);k(Q,c[3]);break}X()}function I(d){switch(a){case'main':b=o(b+d,0,u.length-1);p(u);break;case'gameNew':b=o(b+d,0,y.length-1);p(y);break;case'gameResume':b=o(b+d,0,N.length-1);p(N);break;case'commanderDamage':b=o(b+d,0,c[e].commanderDamageSources.length-1);p(c[e].commanderDamageSources);break;case'inGameOptions':b=o(b+d,0,C.length-1);p(C);break}}function ae(a){if(h===!1)return;e=o(e+a,0,c.length-1),z()}function J(){h=!0,a='',t(d);let b=a1;v==='commander'&&(b=a2),c.splice(0,c.length);for(let a=0;a<i;a++){const d=new a9(a,`Player ${a+1}`,b);D=i,D===1&&(D=6);for(let a=0;a<D;a++){const b=new aa(a,`Player ${a+1}`);d.commanderDamageSources.push(b)}c.push(d)}e=0,z(),V=setInterval(()=>{BTN_PLAY.read()&&(h===!0&&a!='inGameOptions'?(a='inGameOptions',q(C,'Game Options')):a==='inGameOptions'&&(a='',z()))},250)}function af(f){let g=Date.now();if(g-U<a6)return;if(U=g,f!==0&&h===!1)return I(f*-1);if(f===0&&h===!1){switch(!0){case a==='main'&&b===0:a='gameNew';q(y,'New Game');break;case a==='main'&&b===1:a='help';ad();break;case a==='main'&&b===2:K();break;case a==='gameNew'&&b===0:break;case a==='gameNew'&&b===1:v='standard';J();break;case a==='gameNew'&&b===2:v='commander';J();break;case a==='gameNew'&&b===3:a='main';q(u,'Main Menu');break;case a==='gameResume'&&b===0:break;case a==='gameResume'&&b===1:a='main';H('Main Menu');q(u,'Main Menu');break;case a==='help'&&b===0:a='main';q(u,'Main Menu');break}b=0}else if(f!==0&&h===!0)if(a==='commanderDamage')I(f*-1);else if(a==='inGameOptions')I(f*-1);else return ae(f);else if(f===0&&h===!0)if(v==='commander'&&a!='commanderDamage'&&a!='inGameOptions')a='commanderDamage',q(c[e].commanderDamageSources,`Who Dealt Commander Damage to ${c[e].name}?`);else if(v==='commander'&&a==='commanderDamage')a='',z();else if(a==='inGameOptions'){switch(b){case 0:J();break;case 1:h=!1;a='gameNew';t(d);q(y,'New Game');break;case 2:K();break}b=0}}function ag(d){if(h===!1)a==='gameNew'&&b===0&&(i=o(i+d,$,a0),p(y));else if(h===!0&&a!='commanderDamage'&&a!='inGameOptions')c[e].currentLife+=d,z();else if(h===!0&&a==='commanderDamage'){let a=c[e].commanderDamageSources[b].amount;let f=a+d;a=o(a+d,0,21),c[e].commanderDamageSources[b].amount=a,f>-1&&f<22&&(c[e].currentLife+=d*-1),p(c[e].commanderDamageSources)}}function K(){W(),clearInterval(V),Y(),settings.idleTimeout=O,bC.clear(1).flip(),E.reboot()}function ah(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function Y(){Pip.removeAllListeners(R),Pip.removeAllListeners(S),Pip.removeAllListeners(T)}function ai(){Pip.on(R,af),Pip.on(S,ag),Pip.on(T,ah),setWatch(()=>K(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0})}const L={};const M='MTG Life Counter';const Z='1.0.1';const u=['New Game','Help','Exit'];const y=['Player Count','Standard (20HP)','Commander (40HP & 21HP)','Back'];const N=['Yes','Back'];const C=['Reset Current Game','New Game',`Exit ${M}`];const _='Need help with Controls?!\n  Check the readme on GitHub.\nThis app is a work in progress.\n  Report bugs on GitHub.\nThank you for using my app!\n-Tyler';let a='main';let b=0;const $=1;const a0=4;const a1=20;const a2=40;const aj='USER/mtgtracker_gamedata.json';let i=1;let v='standard';let h=!1;let c=[];let e=0;let D;const a3=g.getWidth();const a4=g.getHeight();const a5=!0;let O=settings.idleTimeout;const d={x1:60,y1:40,x2:a3-60,y2:a4-20};const A={x1:d.x1,y1:10,x2:d.x2,y2:d.y2};const r={x1:d.x1+10,y1:d.y1+10,x2:d.x2-10,y2:d.y1+35};const l={x1:r.x1,y1:r.y2+5,x2:r.x2,y2:d.y2-20};const j={x1:d.x1,y1:d.y1,x2:d.x2,y2:(d.y2+d.y1)/2-10};const n={x1:j.x1,y1:j.y2+5,x2:d.x2,y2:d.y2-15};const s={x1:j.x1,y1:j.y1,x2:(d.x2+d.x1)/2-2,y2:j.y2};const w={x1:s.x2+4,y1:j.y1,x2:j.x2,y2:j.y2};const P={x1:s.x1,y1:n.y1,x2:s.x2,y2:n.y2};const Q={x1:w.x1,y1:n.y1,x2:w.x2,y2:n.y2};const R='knob1';const S='knob2';const T='torch';const a6=10;let U=0;let V=null;const a7=49.99923706054;let B=null;const F='#000000';const m=g.theme.fg;const x=g.blendColor(F,m,.5);const a8=g.blendColor(F,m,.8);return L.run=function(){O=settings.idleTimeout,settings.idleTimeout=0,bC.clear(1).flip(),Y(),q(u,'Main Menu'),ac(),ab(),G(),ai()},L}MTGTracker().run()