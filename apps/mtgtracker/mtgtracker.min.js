function MTGTracker(){function a8(a,b,c){this.index=a,this.name=b,this.currentLife=c,this.commanderDamageSources=[]}function a9(a,b){this.index=a,this.fromSource=b,this.amount=0}function n(b,c,d){const a=parseInt(b);return Math.min(Math.max(a,c),d)}function U(){B&&clearInterval(B),B=null}function t(a){g.setColor(a6).fillRect(a)}function aa(){U(),B=setInterval(()=>{drawFooter()},a5)}function f(a){g.setColor(a7).drawRect(a.x1,a.y1,a.x2,a.y2)}function F(){if(a3===!1)return;f(d),f(q),f(l)}function V(){switch(i){case 1:f(d);break;case 2:f(j);f(m);break;case 3:f(r);f(w);f(m);break;case 4:f(r);f(w);f(N);f(O);break}}function ab(){const a=L.toUpperCase();const b='v'+X;const c=70;const d=g.stringWidth(a);g.setColor(s).setFontAlign(-1,-1,0).setFontMonofonto23().drawString(a,A.x1,A.y1),g.setColor(x).setFontAlign(-1,-1,0).setFont('4x6',2).drawString(b,A.x1+d+c,A.y1+14)}function G(b){t(q);const a=5;g.setColor(s).setFontAlign(-1,-1,0).setFontMonofonto16().drawString(b.toUpperCase(),q.x1,q.y1+a)}function o(e){t(l),g.setFontMonofonto16().setFontAlign(-1,-1,0);const c=5;const d=20;e.forEach((e,h)=>{const j=l.y1+h*d+c;let f=e;a==='gameNew'&&h===0&&b===0?f=`Player Count: < ${i} >`:a==='gameNew'&&h===0?f=`Player Count: ${i}`:a==='commanderDamage'&&e.index===b?f=` ${e.fromSource}: < ${e.amount} >`:a==='commanderDamage'&&(f=` ${e.fromSource}: ${e.amount}`),g.setColor(h===b?s:x).drawString(f,l.x1+c,j,!0)}),F()}function ac(){b=0,G('Help'),t(l),g.setFontMonofonto16().setFontAlign(-1,-1,0);const a=5;const c=20;const d=Y.split('\n');d.forEach((d,e)=>{const b=l.y1+e*c+a;g.setColor(x).drawString(d,l.x1+a,b,!0)});const e=l.y2-c-a;g.setColor(s).drawString('Back',l.x1+a,e,!0),F()}function p(a,c){b=0,G(c),o(a)}function k(a,b){t(a),i===1?g.setFontMonofonto28().setFontAlign(0,-1,0):g.setFontMonofonto23().setFontAlign(0,-1,0);const c=10;const d=24;const h=(a.x1+a.x2)/2;const j=a.y1+c;g.setColor(e===b.index?s:x).drawString(b.name,h,j,!0);let f=b.currentLife;e===b.index&&(f=`< ${b.currentLife} >`);const k=(a.x1+a.x2)/2;const l=(a.y1+a.y2)/2-d/2+c;if(g.setColor(e===b.index?s:x).drawString(f,k,l,!0),v==='commander'&&e===b.index){const f='* -> EDH dmg';const h=5+a.x1;let c=a.y2-d+5;i===1&&(c+=-10),g.setColor(e===b.index?s:x).setFontAlign(-1,-1,0).setFont('6x8',2).drawString(f,h,c,!0)}V()}function z(){t(d),g.setFontMonofonto16().setFontAlign(-1,-1,0);switch(i){case 1:k(d,c[0]);break;case 2:k(j,c[1]);k(m,c[0]);break;case 3:k(r,c[1]);k(w,c[2]);k(m,c[0]);break;case 4:k(r,c[1]);k(w,c[2]);k(N,c[0]);k(O,c[3]);break}V()}function H(d){switch(a){case'main':b=n(b+d,0,u.length-1);o(u);break;case'gameNew':b=n(b+d,0,y.length-1);o(y);break;case'gameResume':b=n(b+d,0,M.length-1);o(M);break;case'commanderDamage':b=n(b+d,0,c[e].commanderDamageSources.length-1);o(c[e].commanderDamageSources);break;case'inGameOptions':b=n(b+d,0,C.length-1);o(C);break}}function ad(a){if(h===!1)return;e=n(e+a,0,c.length-1),z()}function I(){h=!0,a='',t(d);let b=$;v==='commander'&&(b=a0),c.splice(0,c.length);for(let a=0;a<i;a++){const d=new a8(a,`Player ${a+1}`,b);D=i,D===1&&(D=6);for(let a=0;a<D;a++){const b=new a9(a,`Player ${a+1}`);d.commanderDamageSources.push(b)}c.push(d)}e=0,z(),T=setInterval(()=>{BTN_PLAY.read()&&(h===!0&&a!='inGameOptions'?(a='inGameOptions',p(C,'Game Options')):a==='inGameOptions'&&(a='',z()))},250)}function ae(f){let g=Date.now();if(g-S<a4)return;if(S=g,f!==0&&h===!1)return H(f*-1);if(f===0&&h===!1){switch(!0){case a==='main'&&b===0:a='gameNew';p(y,'New Game');break;case a==='main'&&b===1:a='help';ac();break;case a==='main'&&b===2:J();break;case a==='gameNew'&&b===0:break;case a==='gameNew'&&b===1:v='standard';I();break;case a==='gameNew'&&b===2:v='commander';I();break;case a==='gameNew'&&b===3:a='main';p(u,'Main Menu');break;case a==='gameResume'&&b===0:break;case a==='gameResume'&&b===1:a='main';G('Main Menu');p(u,'Main Menu');break;case a==='help'&&b===0:a='main';p(u,'Main Menu');break}b=0}else if(f!==0&&h===!0)if(a==='commanderDamage')H(f*-1);else if(a==='inGameOptions')H(f*-1);else return ad(f);else if(f===0&&h===!0)if(v==='commander'&&a!='commanderDamage'&&a!='inGameOptions')a='commanderDamage',p(c[e].commanderDamageSources,`Who Dealt Commander Damage to ${c[e].name}?`);else if(v==='commander'&&a==='commanderDamage')a='',z();else if(a==='inGameOptions'){switch(b){case 0:I();break;case 1:h=!1;a='gameNew';t(d);p(y,'New Game');break;case 2:J();break}b=0}}function af(d){if(h===!1)a==='gameNew'&&b===0&&(i=n(i+d,Z,_),o(y));else if(h===!0&&a!='commanderDamage'&&a!='inGameOptions')c[e].currentLife+=d,z();else if(h===!0&&a==='commanderDamage'){let a=c[e].commanderDamageSources[b].amount;let f=a+d;a=n(a+d,0,21),c[e].commanderDamageSources[b].amount=a,f>-1&&f<22&&(c[e].currentLife+=d*-1),o(c[e].commanderDamageSources)}}function J(){U(),clearInterval(T),W(),bC.clear(1).flip(),E.reboot()}function ag(){const a=[1,5,10,15,20];const b=a.findIndex(a=>a===Pip.brightness);const c=(b+1)%a.length;Pip.brightness=a[c],Pip.updateBrightness()}function W(){Pip.removeAllListeners(P),Pip.removeAllListeners(Q),Pip.removeAllListeners(R)}function ah(){Pip.on(P,ae),Pip.on(Q,af),Pip.on(R,ag),setWatch(()=>J(),BTN_POWER,{debounce:50,edge:'rising',repeat:!0})}const K={};const L='MTG Life Counter';const X='1.0.0';const u=['New Game','Help','Exit'];const y=['Player Count','Standard (20HP)','Commander (40HP & 21HP)','Back'];const M=['Yes','Back'];const C=['Reset Current Game','New Game',`Exit ${L}`];const Y='Need help with Controls?!\n  Check the readme on GitHub.\nThis app is a work in progress.\n  Report bugs on GitHub.\nThank you for using my app!\n-Tyler';let a='main';let b=0;const Z=1;const _=4;const $=20;const a0=40;const ai='USER/mtgtracker_gamedata.json';let i=1;let v='standard';let h=!1;let c=[];let e=0;let D;const a1=g.getWidth();const a2=g.getHeight();const a3=!0;const d={x1:60,y1:40,x2:a1-60,y2:a2-20};const A={x1:d.x1,y1:10,x2:d.x2,y2:d.y2};const q={x1:d.x1+10,y1:d.y1+10,x2:d.x2-10,y2:d.y1+35};const l={x1:q.x1,y1:q.y2+5,x2:q.x2,y2:d.y2-20};const j={x1:d.x1,y1:d.y1,x2:d.x2,y2:(d.y2+d.y1)/2-10};const m={x1:j.x1,y1:j.y2+5,x2:d.x2,y2:d.y2-15};const r={x1:j.x1,y1:j.y1,x2:(d.x2+d.x1)/2-2,y2:j.y2};const w={x1:r.x2+4,y1:j.y1,x2:j.x2,y2:j.y2};const N={x1:r.x1,y1:m.y1,x2:r.x2,y2:m.y2};const O={x1:w.x1,y1:m.y1,x2:w.x2,y2:m.y2};const P='knob1';const Q='knob2';const R='torch';const a4=10;let S=0;let T=null;const a5=49.99923706054;let B=null;const a6='#000000';const s='#00ff00';const x='#007f00';const a7='#003300';return K.run=function(){bC.clear(1).flip(),W(),p(u,'Main Menu'),ab(),aa(),F(),ah()},K}MTGTracker().run()